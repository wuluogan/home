import{_ as e,d8 as a,cP as s,di as l,d9 as t,d7 as r,e as o,f as i,Y as n,u as c,o as m,c as u,d as p,a as d,w as g,t as v,k as y,q as h,ch as j,z as f,dX as k,dY as $,em as b,en as w,e1 as _,d_ as C,d$ as L,g as x,cJ as P,b as T,F as S,x as q,bO as U,eo as I,cX as D,ep as F,eq as N,dQ as A,er as M,p as R,l as E,dZ as H,dd as z}from"./index-d93ecfd9.js";import{D as Q}from"./DataLists-2d284e43.js";import{P as X}from"./index-e01b8113.js";import{g as B}from"./getCoverUrl-bb08aa65.js";import{_ as J}from"./Image-46cbaef1.js";import{_ as Y}from"./Space-76cfe381.js";import{_ as G}from"./text-f881741e.js";import{_ as K}from"./Tag-9bd41f20.js";import{_ as O}from"./Dropdown-ca523edc.js";import{_ as V}from"./Scrollbar-b297dc5c.js";import{_ as Z}from"./Skeleton-8803bfe7.js";import"./AllArtists-e33e1687.js";import"./AddPlaylist-0e9ef9cc.js";import"./CreatePlaylist-db76e905.js";import"./Input-19ebdc3b.js";import"./Suffix-1fd55ec3.js";import"./index-92eb66c0.js";import"./use-merged-state-bb55b613.js";import"./light-1b9db3a7.js";import"./Checkbox-995e550a.js";import"./light-2c22dcb8.js";import"./Avatar-d697b90d.js";import"./utils-5d91cb42.js";import"./light-d2124738.js";import"./SmallSongData-d7110d79.js";import"./FormItem-ccd063f6.js";import"./light-d411e82b.js";import"./Popover-92ca2497.js";import"./light-f76c98be.js";import"./Follower-829f72e1.js";import"./next-frame-once-924ab492.js";import"./cssr-2139d5e3.js";import"./use-compitable-f583eb1a.js";import"./InputNumber-43a45814.js";import"./Add-00122154.js";import"./Alert-a6104c4f.js";import"./_common-60fffae6.js";import"./Radio-24bd6234.js";import"./RadioGroup-cb180d59.js";import"./light-ca51619b.js";import"./get-slot-a0e67e91.js";import"./DrawerContent-b50dea9b.js";import"./light-51fd1fd4.js";import"./Spin-c12f3861.js";import"./light-f8d78f18.js";import"./Pagination-eed167c0.js";import"./Select-d00ca0af.js";import"./create-07671515.js";import"./light-25af1eec.js";import"./light-16e65505.js";import"./Empty-d19cae85.js";import"./light-f5dc26c8.js";import"./create-ref-setter-ee697025.js";import"./light-c2ad2c79.js";import"./Tooltip-0ede3859.js";import"./_common-89f2509f.js";import"./light-6dc1ea6d.js";import"./_common-991711fd.js";import"./light-5ced6f1c.js";import"./use-houdini-2a8f5bbb.js";const W={key:0,class:"playlist"},ee={class:"left"},ae={class:"cover"},se={class:"meta"},le={class:"title"},te={class:"intr"},re={class:"name"},oe={class:"desc text-hidden"},ie={class:"right"},ne={class:"meta"},ce={class:"num"},me={class:"num"},ue={key:1,class:"title"},pe={class:"key"},de=(e=>(R("data-v-fe67a542"),e=e(),E(),e))((()=>p("br",null,null,-1))),ge={key:2,class:"loading"},ve={class:"left"},ye={class:"right"},he=e({__name:"PlayListView",setup(e){const{t:R}=a(),E=s(),he=l(),je=t(),fe=r(),ke=o(E.currentRoute.value.query.id),$e=o(null),be=o([]),we=o(!1),_e=o(30),Ce=o(!0),Le=o(E.currentRoute.value.query.page?Number(E.currentRoute.value.query.page):1),xe=o(0),Pe=e=>()=>f(U,{style:{transform:"translateX(2px)"}},{default:()=>e}),Te=e=>{const a=he.getUserPlayLists.like;return!a.length||!a.some((a=>a.id===Number(e)))},Se=e=>{const a=he.getUserPlayLists.own;return!!a.length&&a.some((a=>a.id===Number(e)))},qe=o([]),Ue=()=>{qe.value=[{key:"copy",label:R("menu.copy",{name:R("general.name.playlist"),other:R("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/playlist?id=${ke.value}`),$message.success(R("general.message.copySuccess"))}catch(e){console.error(R("general.message.copyFailure"),e),$message.error(R("general.message.copyFailure"))}else $message.error(R("general.message.notSupported"))}},icon:Pe(f(H))},{key:"del",label:R("menu.del"),show:he.userLogin&&Se(ke.value),props:{onClick:()=>{Ne($e.value)}},icon:Pe(f(z))},{key:"like",label:Te(ke.value)?R("menu.collection",{name:R("general.name.playlist")}):R("menu.cancelCollection",{name:R("general.name.playlist")}),show:he.userLogin&&!Se(ke.value),props:{onClick:()=>{Ae(ke.value)}},icon:Pe(f(Te(ke.value)?k:$))}]},Ie=e=>{b(e).then((e=>{xe.value=e.playlist.trackCount,$e.value=e.playlist,$setSiteTitle(e.playlist.name+" - "+R("general.name.playlist"))})).catch((e=>{$setSiteTitle(R("general.name.playlist")),Ce.value=!1,console.error($message.error(R("general.message.acquisitionFailed")),e),$message.error(R("general.message.acquisitionFailed"))}))},De=(e,a=30,s=0)=>{w(e,a,s).then((a=>{a.songs?(be.value=[],a.songs.forEach(((a,s)=>{be.value.push({id:a.id,num:s+1+(Le.value-1)*_e.value,name:a.name,artist:a.ar,album:a.al,alia:a.alia,time:_(a.dt),fee:a.fee,sourceId:e,pc:a.pc?a.pc:null,mv:a.mv?a.mv:null})}))):$message.error(R("general.message.acquisitionFailed")),"undefined"!=typeof $scrollToTop&&$scrollToTop()}))},Fe=()=>{try{const e=document.getElementById("datalists").firstElementChild,a=document.querySelectorAll("#datalists > *");let s=!1;if(a.forEach((e=>{e.classList.contains("play")&&(s=!0)})),s)je.setPlayState(!0);else{const a=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});"dblclick"===fe.listClickMode?e.dispatchEvent(a):"click"===fe.listClickMode&&e.click()}}catch(e){console.error($message.error(R("general.message.operationFailed")),e),$message.error($message.error(R("general.message.operationFailed")))}},Ne=e=>{var a;if(e.id===(null==(a=he.getUserPlayLists)?void 0:a.own[0].id))return $message.warning(R("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:R("general.dialog.delete"),content:R("menu.delQuestion",{name:e.name}),positiveText:R("general.dialog.delete"),negativeText:R("general.dialog.cancel"),onPositiveClick:()=>{C(e.id).then((e=>{200===e.code&&($message.success(R("general.message.deleteSuccess")),he.setUserPlayLists(),E.push("/user/playlists"))}))}})},Ae=async e=>{const a=Te(e)?1:2,s=R("general.name.playlist"),l="zh-CN"===fe.language?"":" ";try{200===(await L(a,e)).code?($message.success(`${s+l}${R(1==a?"menu.collection":"menu.cancelCollection",{name:R("general.dialog.success")})}`),he.setUserPlayLists((()=>{Ue()}))):$message.error(`${s+l}${R(1==a?"menu.collection":"menu.cancelCollection",{name:R("general.dialog.failed")})}`)}catch(t){$message.error(`${s+l}${R(1==a?"menu.collection":"menu.cancelCollection",{name:R("general.dialog.failed")})}`),console.error(`${s+l}${R(1==a?"menu.collection":"menu.cancelCollection",{name:R("general.dialog.failed")})}`,t)}};i((()=>{ke.value&&(Ie(ke.value),De(ke.value,_e.value,(Le.value-1)*_e.value),!he.userLogin||he.getUserPlayLists.has||he.getUserPlayLists.isLoading?Ue():he.setUserPlayLists((()=>{Ue()})))}));const Me=e=>{_e.value=e,De(ke.value,e,(Le.value-1)*_e.value)},Re=e=>{E.push({path:"/playlist",query:{id:ke.value,page:e}})};return n((()=>E.currentRoute.value),((e,a)=>{ke.value=e.query.id,Le.value=Number(e.query.page?e.query.page:1),"playlist"==e.name&&(e.query.id!=a.query.id?(Ie(ke.value),De(ke.value,_e.value,(Le.value-1)*_e.value)):De(ke.value,_e.value,(Le.value-1)*_e.value))})),(e,a)=>{var s,l;const t=J,r=x,o=K,i=Y,n=O,f=V,k=P,$=Z;return c($e)?(m(),u("div",W,[p("div",ee,[p("div",ae,[d(t,{"show-toolbar-tooltip":"",class:"coverImg",src:c(B)(c($e).coverImgUrl,1024),"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":c(B)(c($e).coverImgUrl),"fallback-src":"/img/music/pic/default.png"},null,8,["src","preview-src"]),d(t,{"preview-disabled":"",class:"shadow",src:c(B)(c($e).coverImgUrl,1024),"fallback-src":"/img/music/pic/default.png"},null,8,["src"])]),p("div",se,[p("div",le,[d(c(G),{class:"name text-hidden"},{default:g((()=>[T(v(c($e).name),1)])),_:1}),d(c(G),{class:"creator"},{default:g((()=>[T(v(c($e).creator.nickname),1)])),_:1})]),p("div",te,[p("span",re,v(e.$t("general.name.desc",{name:e.$t("general.name.playlist")})),1),p("span",oe,v(c($e).description?c($e).description:e.$t("other.noDesc")),1),(null==(l=null==(s=c($e))?void 0:s.description)?void 0:l.length)>70?(m(),y(r,{key:0,class:"all-desc",block:"",strong:"",secondary:"",onClick:a[0]||(a[0]=e=>we.value=!0)},{default:g((()=>[T(v(e.$t("general.name.allDesc")),1)])),_:1})):h("",!0)]),c($e).tags?(m(),y(i,{key:0,class:"tag"},{default:g((()=>[(m(!0),u(S,null,q(c($e).tags,(e=>(m(),y(o,{class:"tags",round:"",bordered:!1,key:e,onClick:a=>c(E).push(`/discover/playlists?cat=${e}&page=1`)},{default:g((()=>[T(v(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})):h("",!0),d(i,{class:"control"},{default:g((()=>[d(r,{strong:"",secondary:"",round:"",type:"primary",onClick:Fe},{icon:g((()=>[d(c(U),{component:c(I)},null,8,["component"])])),default:g((()=>[T(" "+v(e.$t("general.name.play")),1)])),_:1}),d(n,{placement:"right-start",trigger:"click","show-arrow":!0,options:c(qe)},{default:g((()=>[d(r,{strong:"",secondary:"",circle:""},{icon:g((()=>[d(c(U),{component:c(D)},null,8,["component"])])),_:1})])),_:1},8,["options"])])),_:1})])]),p("div",ie,[p("div",ne,[d(c(G),{class:"name"},{default:g((()=>[T(v(c($e).name),1)])),_:1}),d(c(G),{class:"creator"},{default:g((()=>[d(c(U),{depth:3,component:c(F)},null,8,["component"]),T(" "+v(c($e).creator.nickname),1)])),_:1}),d(i,{class:"time"},{default:g((()=>[p("div",ce,[d(c(U),{depth:3,component:c(N)},null,8,["component"]),d(c(G),{innerHTML:c(A)(c($e).createTime)},null,8,["innerHTML"])]),p("div",me,[d(c(U),{depth:3,component:c(M)},null,8,["component"]),d(c(G),{innerHTML:c(A)(c($e).updateTime)},null,8,["innerHTML"])])])),_:1})]),d(Q,{listData:c(be)},null,8,["listData"]),d(X,{totalCount:c(xe),pageNumber:c(Le),showSizePicker:!1,showQuickJumper:!1,onPageSizeChange:Me,onPageNumberChange:Re},null,8,["totalCount","pageNumber"]),d(k,{class:"s-modal",show:c(we),"onUpdate:show":a[1]||(a[1]=e=>j(we)?we.value=e:null),preset:"card",title:e.$t("general.name.desc",{name:e.$t("general.name.playlist")}),bordered:!1},{default:g((()=>[d(f,null,{default:g((()=>[d(c(G),{innerHTML:c($e).description.replace(/\n/g,"<br>")},null,8,["innerHTML"])])),_:1})])),_:1},8,["show","title"])])])):c(ke)&&c(Ce)?(m(),u("div",ge,[p("div",ve,[d($,{class:"pic"}),d($,{text:"",repeat:5}),d($,{text:"",style:{width:"60%"}})]),p("div",ye,[d($,{sharp:!1,height:"80px",width:"60%"}),d($,{height:"100%",width:"100%"})])])):(m(),u("div",ue,[p("span",pe,v(c(Ce)?e.$t("general.name.noKeywords"):e.$t("general.message.acquisitionFailed")),1),de,d(r,{strong:"",secondary:"",onClick:a[2]||(a[2]=e=>c(E).go(-1)),style:{"margin-top":"20px"}},{default:g((()=>[T(v(e.$t("general.name.goBack")),1)])),_:1})]))}}},[["__scopeId","data-v-fe67a542"]]);export{he as default};
