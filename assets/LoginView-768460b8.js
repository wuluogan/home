import{_ as e,d8 as a,cP as t,di as l,d9 as o,d7 as s,e as n,f as i,i as r,o as u,c as g,d as m,a as d,w as p,b as c,t as v,u as f,k as x,p as h,l as y,an as _}from"./index-d93ecfd9.js";import{g as T,a as j,c as k}from"./login-d4906cc3.js";import{S as I}from"./index.es-210d58fa.js";import{_ as $}from"./text-f881741e.js";import{a as b,_ as q}from"./Tabs-7872627f.js";import{_ as w}from"./Alert-a6104c4f.js";import{_ as S}from"./Skeleton-8803bfe7.js";import"./use-compitable-f583eb1a.js";import"./light-6dc1ea6d.js";import"./Add-00122154.js";import"./use-merged-state-bb55b613.js";import"./cssr-2139d5e3.js";import"./light-af7849c2.js";import"./_common-60fffae6.js";import"./use-houdini-2a8f5bbb.js";const L={class:"login"},O={class:"title"},P=(e=>(h("data-v-032eb444"),e=e(),y(),e))((()=>m("img",{src:"/img/music/logo/favicon.png",alt:"logo"},null,-1))),U={class:"tip"},A=e({__name:"LoginView",setup(e){const{t:h}=a(),y=t(),A=l(),B=o(),C=s(),D={}.VITE_SITE_TITLE,E=n(null),H=n(h("login.qrText1"));n(null),n({phone:null,captcha:null});const N=n(null);n("获取验证码"),n(!1);const V=n(null),z=n(null),J=()=>{T().then((e=>{e.data.profile&&window.localStorage.getItem("cookie")?($message.info(h("login.loggedIn")),A.userLogin=!0,y.push("/user")):(A.userLogOut(),clearInterval(V.value),j().then((e=>{200==e.code?(e.data.unikey,E.value=`https://music.163.com/login?codekey=${e.data.unikey}`,Y(e.data.unikey)):$message.error(h("login.qrText6"))})))}))},Y=e=>{V.value=setInterval((()=>{if(!e)return!1;k(e).then((e=>{var a;800==e.code?(J(),z.value=null,H.value=h("login.qrText2")):801==e.code?(z.value=null,H.value=h("login.qrText1")):802==e.code?(H.value=h("login.qrText3"),z.value||(z.value=$message.loading(h("login.qrText3"),{duration:0}))):803==e.code&&(z.value.destroy(),(a=e).cookie=a.cookie.replaceAll(" HTTPOnly",""),A.setCookie(a.cookie),T().then((e=>{e.data.profile?(A.setUserData(e.data.profile),A.userLogin=!0,H.value=h("login.qrText4"),$message.success(h("login.qrText4")),$signIn&&$signIn(),clearInterval(V.value),y.push("/user")):(A.userLogOut(),$message.error(h("login.qrText5")),J())})))}))}),1e3)},Z=e=>{"qr"==e?J():clearInterval(V.value)};return i((()=>{$setSiteTitle(h("login.login")),B.setPlayBarState(!1),J()})),r((()=>{B.setPlayBarState(!0),clearInterval(V.value),clearInterval(N.value)})),(e,a)=>{const t=$,l=S,o=_,s=q,n=w,i=b;return u(),g("div",L,[m("div",O,[P,d(t,null,{default:p((()=>[c(v(e.$t("login.login",{name:f(D)})),1)])),_:1})]),d(i,{animated:"",class:"content",type:"segment","justify-content":"space-evenly","pane-style":{display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"30px"},"onUpdate:value":Z},{default:p((()=>[d(s,{name:"qr",tab:e.$t("login.qr")},{default:p((()=>[d(o,{class:"qr-img"},{default:p((()=>[f(E)?(u(),x(f(I),{key:1,class:"qr",value:f(E),size:180,level:"H",background:"#00000000",foreground:f(C).themeData.primaryColor},null,8,["value","foreground"])):(u(),x(l,{key:0,style:{"min-width":"180px"},height:"180px",width:"180px"}))])),_:1}),m("span",U,v(f(H)),1)])),_:1},8,["tab"]),d(s,{name:"phone",tab:e.$t("login.phone")},{default:p((()=>[d(n,{style:{width:"100%","margin-top":"-20px","margin-bottom":"12px"},type:"warning"},{default:p((()=>[c(v(e.$t("login.canNotUse")),1)])),_:1})])),_:1},8,["tab"]),d(s,{name:"email",tab:e.$t("login.email")},{default:p((()=>[d(n,{style:{width:"100%","margin-top":"-20px","margin-bottom":"12px"},type:"warning"},{default:p((()=>[c(v(e.$t("login.canNotUse")),1)])),_:1})])),_:1},8,["tab"])])),_:1})])}}},[["__scopeId","data-v-032eb444"]]);export{A as default};
