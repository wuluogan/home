import{_ as t,e,r as a,f as n,o as s,c as o,d as l,j as u,t as r,q as i,F as d,x as c,a as v,w as m,u as p,m as k,v as w,n as g,cj as h,c$ as f,p as y,l as C}from"./index-d93ecfd9.js";import{d as M}from"./dayjs.min-8c8ee1be.js";const $=t=>(y("data-v-ef00a7df"),t=t(),C(),t),x={class:"site-status"},_={class:"container"},Y={class:"status"},j={class:"r-text"},D={class:"text"},S={class:"tip"},b={key:0},H={key:1},T={key:2,class:"time"},V={class:"last-update"},q=$((()=>l("span",null,"更新频率 5 分钟",-1))),F=[$((()=>l("svg",{width:"24",height:"24",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M42 8V24",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M6 24L6 40",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M42 24C42 14.0589 33.9411 6 24 6C18.9145 6 14.3216 8.10896 11.0481 11.5M6 24C6 33.9411 14.0589 42 24 42C28.8556 42 33.2622 40.0774 36.5 36.9519",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"})],-1)))],B={key:0,class:"overview"},E={class:"count"},R=$((()=>l("span",{class:"name"},"站点总数",-1))),A={class:"num"},L={class:"status-num"},U={class:"ok-count"},I=$((()=>l("span",{class:"name"},"正常",-1))),Z={class:"num"},z={class:"down-count"},G=$((()=>l("span",{class:"name"},"异常",-1))),J={class:"num"},K={key:0,class:"unknownCount-count"},N=$((()=>l("span",{class:"name"},"未知",-1))),O={class:"num"},P={key:0},Q={key:0,class:"sites"},W={class:"meta"},X={class:"name"},tt=["href"],et=[$((()=>l("svg",{width:"24",height:"24",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M24 12V4H40V20H32",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M28 20H4V44H28V20Z",fill:"none",stroke:"currentColor","stroke-width":"4","stroke-linejoin":"round"})],-1)))],at=$((()=>l("div",{class:"icon"},null,-1))),nt={class:"tip"},st=["onClick"],ot=["onMouseenter"],lt={class:"summary"},ut=$((()=>l("div",{class:"now"},"今天",-1))),rt={class:"note"},it={class:"day"},dt={key:1,class:"loading"},ct={key:1,class:"error-result"},vt=$((()=>l("div",{class:"error-title"},"调用超限或请求错误，请刷新后重试",-1))),mt={class:"site-charts"},pt={key:0},kt=$((()=>l("h3",null,"站点详细信息",-1))),wt={class:"time"},gt={class:"text"},ht=t({__name:"index",setup(t){const y=(t,e,a,n)=>{const s=performance.now(),o=l=>{const u=l-s;if(u>a)return void n(e);const r=u/a,i=Math.floor(t+(e-t)*r);n(i),requestAnimationFrame(o)};requestAnimationFrame(o)},C=e(30),$=e("loading"),ht=e(null),ft=e(null),yt=e(null),Ct=e(0),Mt=e(!1),$t=e(null),xt=e(null),_t=e(!1),Yt=e({}),jt=a({time:"",text:""}),Dt={loading:"站点状态加载中",error:"部分站点出现异常",allError:"全部站点出现异常",normal:"所有站点运行正常",wrong:"数据请求失败"},St=t=>(Math.floor(100*t)/100).toString(),bt=t=>{const e=Math.floor(t/3600),a=Math.floor(t%3600/60),n=t%60,s=[];return e>0&&s.push(`${e} 小时`),a>0&&s.push(`${a} 分`),n>0&&s.push(`${n} 秒`),s.join(" ")},Ht=t=>{const e=new Date(t),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),u=String(e.getSeconds()).padStart(2,"0");return{year:a,month:n,day:s,hours:o,minutes:l,seconds:u,justTime:`${o}:${l}:${u}`}},Tt=t=>{const{uptime:e,down:a}=t;return e>=100?"normal":e<=0&&0===a.times?"none":"error"},Vt=()=>{_t.value=!1},qt=()=>{const t=Date.now();if(t-Ct.value<6e4)return $message.warning("请稍后再尝试刷新"),!1;ft.value=null,Ft(),Ct.value=t},Ft=async()=>{try{$.value="loading";const t=[],e=M((new Date).setHours(0,0,0,0));for(let i=0;i<C.value;i++)t.push(e.subtract(i,"day"));const a=t.map((t=>`${t.unix()}_${t.add(1,"day").unix()}`)),n=t[t.length-1].unix(),s=t[0].add(1,"day").unix();a.push(`${n}_${s}`);const o=60;if(null!==ft.value){const{data:e,timestamp:a}=ft.value;if((new Date).getTime()-a<1e3*o){const a=Math.floor(701*Math.random())+500;return void setTimeout((()=>{yt.value=Bt(e,t),Rt(yt.value)}),a)}}const l="http://localhost:5000/uptimeRobot",u={api_key:"ur2637941-88d76ff62168aa6f01bf27e0",format:"json",logs:1,log_types:"1-2",logs_start_date:n,logs_end_date:s,custom_uptime_ranges:a.join("-")},r=await h.post(l,u,{timeout:1e4});r.monitors&&(ft.value={data:r.monitors,timestamp:(new Date).getTime()}),yt.value=Bt(r.monitors,t),Rt(yt.value)}catch(t){$.value="wrong",console.error("获取监控数据时出错："+t)}},Bt=(t,e)=>null==t?void 0:t.map((t=>{const a=[],n={};e.forEach(((t,e)=>{n[t.format("YYYYMMDD")]=e,a[e]={date:t,uptime:100,down:{times:0,duration:0}}}));const s=t.logs.reduce(((t,e)=>{if(1===e.type){const s=M.unix(e.datetime).format("YYYYMMDD");t.duration+=e.duration,t.times+=1,void 0!==n[s]&&a[n[s]]&&(a[n[s]].down.duration+=e.duration,a[n[s]].down.times+=1)}return t}),{times:0,duration:0}),o={id:t.id,name:t.friendly_name,url:t.url,average:100,daily:a,total:s,status:"unknown"};return 2===t.status&&(o.status="ok"),9===t.status&&(o.status="down"),o})),Et=a({count:0,okCount:0,downCount:0,unknownCount:0}),Rt=t=>{try{const e=t.every((t=>"ok"===t.status)),a=t.some((t=>"ok"===t.status)),n=t.filter((t=>"ok"===t.status)).length,s=t.filter((t=>"down"===t.status)).length,o=t.filter((t=>"unknown"===t.status)).length,l=document.querySelector('link[rel="shortcut icon"]');l&&(l.href=e?"./images/favicon.ico":"./images/favicon-down.ico"),$.value=e?"normal":a?"error":"allError",ht.value={count:t.length,okCount:n,downCount:s,unknownCount:o||0},y(Et.count,t.length,1e3,(t=>{Et.count=t})),y(Et.okCount,n,1e3,(t=>{Et.okCount=t})),y(Et.downCount,s,1e3,(t=>{Et.downCount=t})),y(Et.unknownCount,o||0,1e3,(t=>{Et.unknownCount=t}))}catch(e){console.error("更改站点状态时出错："+e)}};return n((()=>{Ft()})),(t,e)=>{var a,n;return s(),o("div",x,[l("header",{id:"header",class:u($.value)},[l("div",{class:u(`cover ${$.value}`)},null,2),l("div",_,[l("div",Y,[l("div",{class:u(`icon ${$.value}`)},null,2),l("div",j,[l("div",D,r(Dt[$.value]),1),l("div",S,["loading"===$.value?(s(),o("span",b,"数据加载中...")):"wrong"===$.value?(s(),o("span",H,"这可能是临时性问题，请刷新后重试")):(s(),o("div",T,[l("span",V," 上次更新于 "+r((null==(a=ft.value)?void 0:a.timestamp)?Ht(ft.value.timestamp).justTime:""),1),l("div",{class:"update"},[q,l("div",{class:"refresh",onClick:qt},F)])]))])]),ht.value?(s(),o("div",B,[l("div",E,[R,l("span",A,r(Et.count),1)]),l("div",L,[l("div",U,[I,l("span",Z,r(Et.okCount),1)]),l("div",z,[G,l("span",J,r(Et.downCount),1)]),ht.value.unknownCount?(s(),o("div",K,[N,l("span",O,r(Et.unknownCount),1)])):i("",!0)])])):i("",!0)])])],2),"wrong"!==$.value?(s(),o("div",P,["loading"!==$.value&&yt.value?(s(),o("div",Q,[(s(!0),o(d,null,c(yt.value,(t=>(s(),o("div",{key:t.id,class:u("site "+("ok"!==t.status?"error":"normal"))},[l("div",W,[l("div",X,r(t.name),1),l("a",{href:t.url,target:"_blank",class:"site-link"},et,8,tt),l("div",{class:u("status "+("ok"===t.status?"normal":"unknown"===t.status?"unknown":"error"))},[at,l("span",nt,r("ok"===t.status?"正常访问":"unknown"===t.status?"状态未知":"无法访问"),1)],2)]),l("div",{class:"timeline",onClick:e=>{return a=t,Mt.value=!0,void($t.value=a);var a}},[(s(!0),o(d,null,c(t.daily,((t,e)=>(s(),o("div",{key:e,class:u(`line ${Tt(t)}`),onMouseenter:e=>((t,e,a)=>{const{uptime:n,down:s,date:o}=e,l=o.format("YYYY-MM-DD");let u="";u=n>=100?`可用率 ${St(n)}%`:n<=0&&0===s.times?"无数据":`故障 ${s.times} 次，累计 ${bt(s.duration)}，可用率 ${St(n)}%`,jt.time=l,jt.text=u;const r=t.target.getBoundingClientRect();Yt.value={top:r.top-60+"px",left:r.left-50+"px"},_t.value=!0})(e,t),onMouseleave:Vt},null,42,ot)))),128))],8,st),l("div",lt,[ut,l("div",rt,r(t.total.times?`最近 ${C.value} 天内故障 ${t.total.times} 次，累计 ${bt(t.total.duration)}，平均可用率 ${t.average}%`:`最近 ${C.value} 天内可用率 ${t.average}%`),1),l("div",it,r(t.daily[t.daily.length-1].date.format("YYYY-MM-DD")),1)])],2)))),128))])):(s(),o("div",dt))])):(s(),o("div",ct,[vt,l("button",{class:"retry-button",onClick:e[0]||(e[0]=e=>t.location.reload())},"重试")])),v(p(f),{show:Mt.value,"onUpdate:show":e[1]||(e[1]=t=>Mt.value=t),title:null==(n=$t.value)?void 0:n.name,preset:"card",style:{width:"80%"}},{default:m((()=>[l("div",mt,[$t.value?(s(),o("div",pt,[kt,l("p",null,"URL: "+r($t.value.url),1),l("p",null,"平均可用率: "+r($t.value.average)+"%",1),l("p",null,"故障次数: "+r($t.value.total.times),1),l("p",null,"故障总时长: "+r(bt($t.value.total.duration)),1)])):i("",!0)])])),_:1},8,["show","title"]),k(l("div",{class:"tooltip",ref_key:"tooltip",ref:xt,style:g(Yt.value)},[l("div",wt,r(jt.time),1),l("div",gt,r(jt.text),1)],4),[[w,_t.value]])])}}},[["__scopeId","data-v-ef00a7df"]]);export{ht as default};
