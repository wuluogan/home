import{a as e,l as s}from"./album-72ad8940.js";import{_ as a,d8 as t,cP as l,di as o,d9 as r,d7 as i,e as n,f as m,Y as c,u as p,o as u,c as d,d as g,a as h,w as j,t as v,k as b,q as f,ch as y,z as k,dX as $,dY as _,e1 as w,g as C,cJ as x,b as L,F as A,x as S,bO as D,eo as T,cX as I,ep as U,eh as F,dQ as M,et as E,p as H,l as R,dZ as q}from"./index-d93ecfd9.js";import{D as P}from"./DataLists-2d284e43.js";import{g as N}from"./getCoverUrl-bb08aa65.js";import{_ as X}from"./Image-46cbaef1.js";import{_ as z}from"./Space-76cfe381.js";import{_ as B}from"./text-f881741e.js";import{_ as Y}from"./Tag-9bd41f20.js";import{_ as Z}from"./Dropdown-ca523edc.js";import{_ as G}from"./Scrollbar-b297dc5c.js";import{_ as J}from"./Skeleton-8803bfe7.js";import"./AllArtists-e33e1687.js";import"./AddPlaylist-0e9ef9cc.js";import"./CreatePlaylist-db76e905.js";import"./Input-19ebdc3b.js";import"./Suffix-1fd55ec3.js";import"./index-92eb66c0.js";import"./use-merged-state-bb55b613.js";import"./light-1b9db3a7.js";import"./Checkbox-995e550a.js";import"./light-2c22dcb8.js";import"./Avatar-d697b90d.js";import"./utils-5d91cb42.js";import"./light-d2124738.js";import"./SmallSongData-d7110d79.js";import"./FormItem-ccd063f6.js";import"./light-d411e82b.js";import"./Popover-92ca2497.js";import"./light-f76c98be.js";import"./Follower-829f72e1.js";import"./next-frame-once-924ab492.js";import"./cssr-2139d5e3.js";import"./use-compitable-f583eb1a.js";import"./InputNumber-43a45814.js";import"./Add-00122154.js";import"./Alert-a6104c4f.js";import"./_common-60fffae6.js";import"./Radio-24bd6234.js";import"./RadioGroup-cb180d59.js";import"./light-ca51619b.js";import"./get-slot-a0e67e91.js";import"./DrawerContent-b50dea9b.js";import"./light-51fd1fd4.js";import"./Spin-c12f3861.js";import"./light-f8d78f18.js";import"./light-c2ad2c79.js";import"./Tooltip-0ede3859.js";import"./_common-89f2509f.js";import"./light-6dc1ea6d.js";import"./_common-991711fd.js";import"./create-07671515.js";import"./light-5ced6f1c.js";import"./create-ref-setter-ee697025.js";import"./use-houdini-2a8f5bbb.js";const K=e=>(H("data-v-f1ae726a"),e=e(),R(),e),Q={key:0,class:"album"},V={class:"left"},O={class:"cover"},W=K((()=>g("img",{src:"/img/music/pic/album.png",class:"album",alt:"album"},null,-1))),ee={class:"meta"},se={class:"title"},ae={class:"intr"},te={class:"name"},le={class:"desc text-hidden"},oe={class:"right"},re={class:"meta"},ie={class:"num"},ne={key:0,class:"num"},me={key:1,class:"title"},ce={class:"key"},pe=K((()=>g("br",null,null,-1))),ue={key:2,class:"loading"},de={class:"left"},ge={class:"right"},he=a({__name:"AlbumView",setup(a){const{t:H}=t(),R=l(),K=o(),he=r(),je=i(),ve=n(R.currentRoute.value.query.id),be=n(null),fe=n([]),ye=n(!1),ke=e=>()=>k(D,{style:{transform:"translateX(2px)"}},{default:()=>e}),$e=e=>{const s=K.getUserAlbumLists.list;return!s.length||!s.some((s=>s.id===Number(e)))},_e=n([]),we=()=>{_e.value=[{key:"copy",label:H("menu.copy",{name:H("general.name.album"),other:H("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/playlist?id=${ve.value}`),$message.success(H("general.message.copySuccess"))}catch(e){console.error(H("general.message.copyFailure"),e),$message.error(H("general.message.copyFailure"))}else $message.error(H("general.message.notSupported"))}},icon:ke(k(q))},{key:"like",label:$e(ve.value)?H("menu.collection",{name:H("general.name.album")}):H("menu.cancelCollection",{name:H("general.name.album")}),show:K.userLogin,props:{onClick:()=>{Le(ve.value)}},icon:ke(k($e(ve.value)?$:_))}]},Ce=s=>{e(s).then((e=>{be.value=e.album,$setSiteTitle(e.album.name+" - "+H("general.name.album")),e.songs?(fe.value=[],e.songs.forEach(((e,a)=>{fe.value.push({id:e.id,num:a+1,name:e.name,artist:e.ar,album:e.al,alia:e.alia,time:w(e.dt),fee:e.fee,sourceId:s,pc:e.pc?e.pc:null,mv:e.mv?e.mv:null})}))):$message.error(H("general.message.acquisitionFailed"))}))},xe=()=>{try{const e=document.getElementById("datalists").firstElementChild,s=document.querySelectorAll("#datalists > *");let a=!1;if(s.forEach((e=>{e.classList.contains("play")&&(a=!0)})),a)he.setPlayState(!0);else{const s=new MouseEvent("dblclick",{bubbles:!0,cancelable:!0,view:window});"dblclick"===je.listClickMode?e.dispatchEvent(s):"click"===je.listClickMode&&e.click()}}catch(e){console.error($message.error(H("general.message.operationFailed")),e),$message.error($message.error(H("general.message.operationFailed")))}},Le=async e=>{const a=$e(e)?1:2,t=H("general.name.album"),l="zh-CN"===je.language?"":" ";try{200===(await s(a,e)).code?($message.success(`${t+l}${H(1==a?"menu.collection":"menu.cancelCollection",{name:H("general.dialog.success")})}`),K.setUserAlbumLists((()=>{we()}))):$message.error(`${t+l}${H(1==a?"menu.collection":"menu.cancelCollection",{name:H("general.dialog.failed")})}`)}catch(o){$message.error(`${t+l}${H(1==a?"menu.collection":"menu.cancelCollection",{name:H("general.dialog.failed")})}`),console.error(`${t+l}${H(1==a?"menu.collection":"menu.cancelCollection",{name:H("general.dialog.failed")})}`,o)}};return m((()=>{ve.value&&(Ce(ve.value),!K.userLogin||K.getUserAlbumLists.has||K.getUserAlbumLists.isLoading?we():K.setUserAlbumLists((()=>{we()})))})),c((()=>R.currentRoute.value),(e=>{ve.value=e.query.id,"album"==e.name&&Ce(ve.value)})),(e,s)=>{var a;const t=X,l=C,o=Y,r=z,i=Z,n=G,m=x,c=J;return p(be)?(u(),d("div",Q,[g("div",V,[g("div",O,[h(t,{"show-toolbar-tooltip":"",class:"coverImg",src:p(N)(p(be).picUrl,1024),"previewed-img-props":{style:{borderRadius:"8px"}},"preview-src":p(N)(p(be).picUrl),"fallback-src":"/img/music/pic/default.png"},null,8,["src","preview-src"]),W]),g("div",ee,[g("div",se,[h(p(B),{class:"name"},{default:j((()=>[L(v(p(be).name),1)])),_:1}),h(p(B),{class:"creator",onClick:s[0]||(s[0]=e=>p(R).push(`/artist/songs?id=${p(be).artist.id}`))},{default:j((()=>[L(v(p(be).artist.name),1)])),_:1})]),g("div",ae,[g("span",te,v(e.$t("general.name.desc",{name:e.$t("general.name.album")})),1),g("span",le,v(p(be).description?p(be).description:e.$t("other.noDesc")),1),(null==(a=p(be))?void 0:a.description.length)>70?(u(),b(l,{key:0,class:"all-desc",block:"",strong:"",secondary:"",onClick:s[1]||(s[1]=e=>ye.value=!0)},{default:j((()=>[L(v(e.$t("general.name.allDesc")),1)])),_:1})):f("",!0)]),p(be).tags?(u(),b(r,{key:0,class:"tag"},{default:j((()=>[(u(!0),d(A,null,S(p(be).tags,(e=>(u(),b(o,{class:"tags",round:"",bordered:!1,key:e},{default:j((()=>[L(v(e),1)])),_:2},1024)))),128))])),_:1})):f("",!0),h(r,{class:"control"},{default:j((()=>[h(l,{strong:"",secondary:"",round:"",type:"primary",onClick:xe},{icon:j((()=>[h(p(D),{component:p(T)},null,8,["component"])])),default:j((()=>[L(" "+v(e.$t("general.name.play")),1)])),_:1}),h(i,{placement:"right-start",trigger:"click","show-arrow":!0,options:p(_e)},{default:j((()=>[h(l,{strong:"",secondary:"",circle:""},{icon:j((()=>[h(p(D),{component:p(I)},null,8,["component"])])),_:1})])),_:1},8,["options"])])),_:1})])]),g("div",oe,[g("div",re,[h(p(B),{class:"name"},{default:j((()=>[L(v(p(be).name),1)])),_:1}),h(p(B),{class:"creator",onClick:s[2]||(s[2]=e=>p(R).push(`/artist/songs?id=${p(be).artist.id}`))},{default:j((()=>[h(p(D),{depth:3,component:p(U)},null,8,["component"]),L(" "+v(p(be).artist.name),1)])),_:1}),h(r,{class:"time"},{default:j((()=>[g("div",ie,[h(p(D),{depth:3,component:p(F)},null,8,["component"]),h(p(B),{innerHTML:p(M)(p(be).publishTime)},null,8,["innerHTML"])]),p(be).company?(u(),d("div",ne,[h(p(D),{depth:3,component:p(E)},null,8,["component"]),h(p(B),{innerHTML:p(be).company},null,8,["innerHTML"])])):f("",!0)])),_:1})]),h(P,{listData:p(fe),hideAlbum:""},null,8,["listData"]),h(m,{class:"s-modal",show:p(ye),"onUpdate:show":s[3]||(s[3]=e=>y(ye)?ye.value=e:null),preset:"card",title:e.$t("general.name.desc",{name:e.$t("general.name.album")}),bordered:!1},{default:j((()=>[h(n,null,{default:j((()=>[h(p(B),{innerHTML:p(be).description.replace(/\n/g,"<br>")},null,8,["innerHTML"])])),_:1})])),_:1},8,["show","title"])])])):p(ve)?(u(),d("div",ue,[g("div",de,[h(c,{class:"pic"}),h(c,{text:"",repeat:5}),h(c,{text:"",style:{width:"60%"}})]),g("div",ge,[h(c,{sharp:!1,height:"80px",width:"60%"}),h(c,{height:"100%",width:"100%"})])])):(u(),d("div",me,[g("span",ce,v(e.$t("general.name.noKeywords")),1),pe,h(l,{strong:"",secondary:"",onClick:s[4]||(s[4]=e=>p(R).go(-1)),style:{"margin-top":"20px"}},{default:j((()=>[L(v(e.$t("general.name.goBack")),1)])),_:1})]))}}},[["__scopeId","data-v-f1ae726a"]]);export{he as default};
