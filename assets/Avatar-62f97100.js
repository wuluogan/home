import{i as e,o as r}from"./utils-48198701.js";import{t as o}from"./Tag-827106b2.js";import{B as n,$ as a,a5 as t,P as s,a6 as l,a4 as i,y as d,C as c,e as u,D as v,s as f,A as h,Y as b,aa as g,ab as m,bR as p,f as z,Q as y,i as x,W as j,bg as F,z as O,V as R}from"./index-c72c5b0c.js";import{a as L}from"./light-4ec95d76.js";const P=n("n-avatar-group"),E=a("avatar","\n width: var(--n-merged-size);\n height: var(--n-merged-size);\n color: #FFF;\n font-size: var(--n-font-size);\n display: inline-flex;\n position: relative;\n overflow: hidden;\n text-align: center;\n border: var(--n-border);\n border-radius: var(--n-border-radius);\n --n-merged-color: var(--n-color);\n background-color: var(--n-merged-color);\n transition:\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n",[t(s("&","--n-merged-color: var(--n-color-modal);")),l(s("&","--n-merged-color: var(--n-color-popover);")),s("img","\n width: 100%;\n height: 100%;\n "),i("text","\n white-space: nowrap;\n display: inline-block;\n position: absolute;\n left: 50%;\n top: 50%;\n "),a("icon","\n vertical-align: bottom;\n font-size: calc(var(--n-merged-size) - 6px);\n "),i("text","line-height: 1.25")]),S=d({name:"Avatar",props:Object.assign(Object.assign({},h.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),setup(n){const{mergedClsPrefixRef:a,inlineThemeDisabled:t}=c(n),s=u(!1);let l=null;const i=u(null),d=u(null),j=v(P,null),F=f((()=>{const{size:e}=n;if(e)return e;const{size:r}=j||{};return r||"medium"})),O=h("Avatar","-avatar",E,L,n,a),R=v(o,null),S=f((()=>{if(j)return!0;const{round:e,circle:r}=n;return void 0!==e||void 0!==r?e||r:!!R&&R.roundRef.value})),k=f((()=>!!j||(n.bordered||!1)));b((()=>n.src),(()=>s.value=!1));const T=f((()=>{const e=F.value,r=S.value,o=k.value,{color:a}=n,{self:{borderRadius:t,fontSize:s,color:l,border:i,colorModal:d,colorPopover:c},common:{cubicBezierEaseInOut:u}}=O.value;let v;return v="number"==typeof e?`${e}px`:O.value.self[g("height",e)],{"--n-font-size":s,"--n-border":o?i:"none","--n-border-radius":r?"50%":t,"--n-color":a||l,"--n-color-modal":a||d,"--n-color-popover":a||c,"--n-bezier":u,"--n-merged-size":`var(--n-avatar-size-override, ${v})`}})),$=t?m("avatar",f((()=>{const e=F.value,r=S.value,o=k.value,{color:a}=n;let t="";return e&&(t+="number"==typeof e?`a${e}`:e[0]),r&&(t+="b"),o&&(t+="c"),a&&(t+=p(a)),t})),T,n):void 0,C=u(!n.lazy);z((()=>{if(e)return;let o;const a=y((()=>{null==o||o(),o=void 0,n.lazy&&(o=r(d.value,n.intersectionObserverOptions,C))}));x((()=>{a(),null==o||o()}))}));const w=u(!n.lazy);return{textRef:i,selfRef:d,mergedRoundRef:S,mergedClsPrefix:a,fitTextTransform:()=>{const{value:e}=i;if(e&&(null===l||l!==e.innerHTML)){l=e.innerHTML;const{value:r}=d;if(r){const{offsetWidth:o,offsetHeight:n}=r,{offsetWidth:a,offsetHeight:t}=e,s=.9,l=Math.min(o/a*s,n/t*s,1);e.style.transform=`translateX(-50%) translateY(-50%) scale(${l})`}}},cssVars:t?void 0:T,themeClass:null==$?void 0:$.themeClass,onRender:null==$?void 0:$.onRender,hasLoadError:s,handleError:e=>{var r;if(!C.value)return;s.value=!0;const{onError:o,imgProps:a}=n;null===(r=null==a?void 0:a.onError)||void 0===r||r.call(a,e),o&&o(e)},shouldStartLoading:C,loaded:w,mergedOnLoad:e=>{var r;const{onLoad:o,imgProps:a}=n;null==o||o(e),null===(r=null==a?void 0:a.onLoad)||void 0===r||r.call(a,e),w.value=!0}}},render(){var r,o;const{$slots:n,src:a,mergedClsPrefix:t,lazy:s,onRender:l,mergedOnLoad:i,shouldStartLoading:d,loaded:c,hasLoadError:u}=this;let v;null==l||l();const f=!c&&!u&&(this.renderPlaceholder?this.renderPlaceholder():null===(o=(r=this.$slots).placeholder)||void 0===o?void 0:o.call(r));return v=this.hasLoadError?this.renderFallback?this.renderFallback():j(n.fallback,(()=>[O("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})])):F(n.default,(r=>{if(r)return O(R,{onResize:this.fitTextTransform},{default:()=>O("span",{ref:"textRef",class:`${t}-avatar__text`},r)});if(a){const{imgProps:r}=this;return O("img",Object.assign(Object.assign({},r),{loading:e&&!this.intersectionObserverOptions&&s?"lazy":"eager",src:e||d||c?a:void 0,onLoad:i,"data-image-src":a,onError:this.handleError,style:[null==r?void 0:r.style,{objectFit:this.objectFit},f?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}})),O("span",{ref:"selfRef",class:[`${t}-avatar`,this.themeClass],style:this.cssVars},v,s&&f)}});export{S as _};
