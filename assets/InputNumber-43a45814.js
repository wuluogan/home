import{y as e,z as n,aO as t,aM as i,aP as l,P as r,$ as o,C as u,A as a,ak as s,e as d,Z as f,O as c,Y as p,ar as m,s as v,at as h,bg as g,J as b,W as x,N as I,bV as w,X as y,am as B}from"./index-d93ecfd9.js";import{i as V}from"./light-1b9db3a7.js";import{u as D}from"./Suffix-1fd55ec3.js";import{u as T}from"./use-merged-state-bb55b613.js";import{_ as C}from"./Input-19ebdc3b.js";import{A as O}from"./Add-00122154.js";const P=e({name:"Remove",render:()=>n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},n("line",{x1:"400",y1:"256",x2:"112",y2:"256",style:"\n        fill: none;\n        stroke: currentColor;\n        stroke-linecap: round;\n        stroke-linejoin: round;\n        stroke-width: 32px;\n      "}))}),F=t({name:"InputNumber",common:i,peers:{Button:l,Input:V},self:e=>{const{textColorDisabled:n}=e;return{iconColorDisabled:n}}});function N(e){return null==e||"string"==typeof e&&""===e.trim()?null:Number(e)}function S(e){return null==e||!Number.isNaN(e)}function U(e,n){return null==e?"":void 0===n?String(e):e.toFixed(n)}function k(e){if(null===e)return null;if("number"==typeof e)return e;{const n=Number(e);return Number.isNaN(n)?null:n}}const M=r([o("input-number-suffix","\n display: inline-block;\n margin-right: 10px;\n "),o("input-number-prefix","\n display: inline-block;\n margin-left: 10px;\n ")]),R=e({name:"InputNumber",props:Object.assign(Object.assign({},a.props),{autofocus:Boolean,loading:{type:Boolean,default:void 0},placeholder:String,defaultValue:{type:Number,default:null},value:Number,step:{type:[Number,String],default:1},min:[Number,String],max:[Number,String],size:String,disabled:{type:Boolean,default:void 0},validator:Function,bordered:{type:Boolean,default:void 0},showButton:{type:Boolean,default:!0},buttonPlacement:{type:String,default:"right"},readonly:Boolean,clearable:Boolean,keyboard:{type:Object,default:{}},updateValueOnInput:{type:Boolean,default:!0},parse:Function,format:Function,precision:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onChange:[Function,Array]}),setup(e){const{mergedBorderedRef:n,mergedClsPrefixRef:t,mergedRtlRef:i}=u(e),l=a("InputNumber","-input-number",M,F,e,t),{localeRef:r}=D("InputNumber"),o=s(e),{mergedSizeRef:g,mergedDisabledRef:x,mergedStatusRef:I}=o,w=d(null),V=d(null),C=d(null),O=d(e.defaultValue),P=f(e,"value"),R=T(P,O),A=d(""),$=e=>{const n=String(e).split(".")[1];return n?n.length:0},j=c((()=>{const{placeholder:n}=e;return void 0!==n?n:r.value.placeholder})),z=c((()=>{const n=k(e.step);return null!==n?0===n?1:Math.abs(n):1})),E=c((()=>{const n=k(e.min);return null!==n?n:null})),K=c((()=>{const n=k(e.max);return null!==n?n:null})),L=n=>{const{value:t}=R;if(n===t)return void _();const{"onUpdate:value":i,onUpdateValue:l,onChange:r}=e,{nTriggerFormInput:u,nTriggerFormChange:a}=o;r&&y(r,n),l&&y(l,n),i&&y(i,n),O.value=n,u(),a()},X=({offset:n,doUpdateIfValid:t,fixPrecision:i,isInputing:l})=>{const{value:r}=A;if(l&&((o=r).includes(".")&&(/^(-)?\d+.*(\.|0)$/.test(o)||/^\.\d+$/.test(o))))return!1;var o;const u=(e.parse||N)(r);if(null===u)return t&&L(null),null;if(S(u)){const r=$(u),{precision:o}=e;if(void 0!==o&&o<r&&!i)return!1;let a=parseFloat((u+n).toFixed(null!=o?o:(n=>{const t=[e.min,e.max,e.step,n].map((e=>void 0===e?0:$(e)));return Math.max(...t)})(u)));if(S(a)){const{value:n}=K,{value:i}=E;if(null!==n&&a>n){if(!t||l)return!1;a=n}if(null!==i&&a<i){if(!t||l)return!1;a=i}return!(e.validator&&!e.validator(a))&&(t&&L(a),a)}}return!1},_=()=>{const{value:n}=R;if(S(n)){const{format:t,precision:i}=e;t?A.value=t(n):null===n||void 0===i||$(n)>i?A.value=U(n,void 0):A.value=U(n,i)}else A.value=String(n)};_();const J=c((()=>!1===X({offset:0,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1}))),W=c((()=>{const{value:n}=R;if(e.validator&&null===n)return!1;const{value:t}=z;return!1!==X({offset:-t,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})})),Y=c((()=>{const{value:n}=R;if(e.validator&&null===n)return!1;const{value:t}=z;return!1!==X({offset:+t,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})}));function Z(){const{value:n}=Y;if(!n)return void le();const{value:t}=R;if(null===t)e.validator||L(Q());else{const{value:e}=z;X({offset:e,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}function q(){const{value:n}=W;if(!n)return void ie();const{value:t}=R;if(null===t)e.validator||L(Q());else{const{value:e}=z;X({offset:-e,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}const G=function(n){const{onFocus:t}=e,{nTriggerFormFocus:i}=o;t&&y(t,n),i()},H=function(n){var t,i;if(n.target===(null===(t=w.value)||void 0===t?void 0:t.wrapperElRef))return;const l=X({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0});if(!1!==l){const e=null===(i=w.value)||void 0===i?void 0:i.inputElRef;e&&(e.value=String(l||"")),R.value===l&&_()}else _();const{onBlur:r}=e,{nTriggerFormBlur:u}=o;r&&y(r,n),u(),B((()=>{_()}))};function Q(){if(e.validator)return null;const{value:n}=E,{value:t}=K;return null!==n?Math.max(0,n):null!==t?Math.min(0,t):0}let ee=null,ne=null,te=null;function ie(){te&&(window.clearTimeout(te),te=null),ee&&(window.clearInterval(ee),ee=null)}function le(){re&&(window.clearTimeout(re),re=null),ne&&(window.clearInterval(ne),ne=null)}let re=null;p(R,(()=>{_()}));const oe={focus:()=>{var e;return null===(e=w.value)||void 0===e?void 0:e.focus()},blur:()=>{var e;return null===(e=w.value)||void 0===e?void 0:e.blur()}},ue=m("InputNumber",i,t);return Object.assign(Object.assign({},oe),{rtlEnabled:ue,inputInstRef:w,minusButtonInstRef:V,addButtonInstRef:C,mergedClsPrefix:t,mergedBordered:n,uncontrolledValue:O,mergedValue:R,mergedPlaceholder:j,displayedValueInvalid:J,mergedSize:g,mergedDisabled:x,displayedValue:A,addable:Y,minusable:W,mergedStatus:I,handleFocus:G,handleBlur:H,handleClear:function(n){!function(n){const{onClear:t}=e;t&&y(t,n)}(n),L(null)},handleMouseDown:function(e){var n,t,i;(null===(n=C.value)||void 0===n?void 0:n.$el.contains(e.target))&&e.preventDefault(),(null===(t=V.value)||void 0===t?void 0:t.$el.contains(e.target))&&e.preventDefault(),null===(i=w.value)||void 0===i||i.activate()},handleAddClick:()=>{ne||Z()},handleMinusClick:()=>{ee||q()},handleAddMousedown:function(){le(),re=window.setTimeout((()=>{ne=window.setInterval((()=>{Z()}),100)}),800),b("mouseup",document,le,{once:!0})},handleMinusMousedown:function(){ie(),te=window.setTimeout((()=>{ee=window.setInterval((()=>{q()}),100)}),800),b("mouseup",document,ie,{once:!0})},handleKeyDown:function(n){var t,i;if("Enter"===n.key){if(n.target===(null===(t=w.value)||void 0===t?void 0:t.wrapperElRef))return;!1!==X({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})&&(null===(i=w.value)||void 0===i||i.deactivate())}else if("ArrowUp"===n.key){if(!Y.value)return;if(!1===e.keyboard.ArrowUp)return;n.preventDefault();!1!==X({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})&&Z()}else if("ArrowDown"===n.key){if(!W.value)return;if(!1===e.keyboard.ArrowDown)return;n.preventDefault();!1!==X({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})&&q()}},handleUpdateDisplayedValue:function(n){A.value=n,!e.updateValueOnInput||e.format||e.parse||void 0!==e.precision||X({offset:0,doUpdateIfValid:!0,isInputing:!0,fixPrecision:!1})},mergedTheme:l,inputThemeOverrides:{paddingSmall:"0 8px 0 10px",paddingMedium:"0 8px 0 12px",paddingLarge:"0 8px 0 14px"},buttonThemeOverrides:v((()=>{const{self:{iconColorDisabled:e}}=l.value,[n,t,i,r]=h(e);return{textColorTextDisabled:`rgb(${n}, ${t}, ${i})`,opacityDisabled:`${r}`}}))})},render(){const{mergedClsPrefix:e,$slots:t}=this,i=()=>n(w,{text:!0,disabled:!this.minusable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleMinusClick,onMousedown:this.handleMinusMousedown,ref:"minusButtonInstRef"},{icon:()=>x(t["minus-icon"],(()=>[n(I,{clsPrefix:e},{default:()=>n(P,null)})]))}),l=()=>n(w,{text:!0,disabled:!this.addable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleAddClick,onMousedown:this.handleAddMousedown,ref:"addButtonInstRef"},{icon:()=>x(t["add-icon"],(()=>[n(I,{clsPrefix:e},{default:()=>n(O,null)})]))});return n("div",{class:[`${e}-input-number`,this.rtlEnabled&&`${e}-input-number--rtl`]},n(C,{ref:"inputInstRef",autofocus:this.autofocus,status:this.mergedStatus,bordered:this.mergedBordered,loading:this.loading,value:this.displayedValue,onUpdateValue:this.handleUpdateDisplayedValue,theme:this.mergedTheme.peers.Input,themeOverrides:this.mergedTheme.peerOverrides.Input,builtinThemeOverrides:this.inputThemeOverrides,size:this.mergedSize,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,readonly:this.readonly,textDecoration:this.displayedValueInvalid?"line-through":void 0,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeydown:this.handleKeyDown,onMousedown:this.handleMouseDown,onClear:this.handleClear,clearable:this.clearable,internalLoadingBeforeSuffix:!0},{prefix:()=>{var l;return this.showButton&&"both"===this.buttonPlacement?[i(),g(t.prefix,(t=>t?n("span",{class:`${e}-input-number-prefix`},t):null))]:null===(l=t.prefix)||void 0===l?void 0:l.call(t)},suffix:()=>{var r;return this.showButton?[g(t.suffix,(t=>t?n("span",{class:`${e}-input-number-suffix`},t):null)),"right"===this.buttonPlacement?i():null,l()]:null===(r=t.suffix)||void 0===r?void 0:r.call(t)}}))}});export{R as _};
