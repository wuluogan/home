import{_ as e,cN as a,cB as t,cQ as l,cO as s,cM as o,e as n,f as i,i as r,o as u,c,d as g,a as m,w as p,b as d,t as v,u as f,k as x,p as h,l as y,an as _}from"./index-c72c5b0c.js";import{g as T,a as j,c as $}from"./login-8eba4a94.js";import{S as k}from"./index.es-210d58fa.js";import{_ as I}from"./text-64fc9966.js";import{a as q,_ as b}from"./Tabs-aac9f9b1.js";import{_ as w}from"./Alert-e807b2ba.js";import{_ as S}from"./Skeleton-163a49d9.js";import"./use-compitable-a1866e01.js";import"./light-a7677734.js";import"./Add-b088e338.js";import"./use-merged-state-74230ec8.js";import"./cssr-ed8d5782.js";import"./light-66678653.js";import"./_common-60fffae6.js";import"./use-houdini-1a86f12f.js";const L={class:"login"},O={class:"title"},E=(e=>(h("data-v-d3ecce78"),e=e(),y(),e))((()=>g("img",{src:"/img/music/logo/favicon.png",alt:"logo"},null,-1))),U={class:"tip"},A=e({__name:"LoginView",setup(e){const{t:h}=a(),y=t(),A=l(),B=s(),D=o(),N={}.VITE_SITE_TITLE,P=n(null),C=n(h("login.qrText1"));n(null),n({phone:null,captcha:null});const H=n(null);n("获取验证码"),n(!1);const Q=n(null),V=n(null),z=()=>{T().then((e=>{e.data.profile&&window.localStorage.getItem("cookie")?($message.info(h("login.loggedIn")),A.userLogin=!0,y.push("/music/user")):(A.userLogOut(),clearInterval(Q.value),j().then((e=>{200==e.code?(e.data.unikey,P.value=`https://music.163.com/login?codekey=${e.data.unikey}`,F(e.data.unikey)):$message.error(h("login.qrText6"))})))}))},F=e=>{Q.value=setInterval((()=>{if(!e)return!1;$(e).then((e=>{var a;800==e.code?(z(),V.value=null,C.value=h("login.qrText2")):801==e.code?(V.value=null,C.value=h("login.qrText1")):802==e.code?(C.value=h("login.qrText3"),V.value||(V.value=$message.loading(h("login.qrText3"),{duration:0}))):803==e.code&&(V.value.destroy(),(a=e).cookie=a.cookie.replaceAll(" HTTPOnly",""),A.setCookie(a.cookie),T().then((e=>{e.data.profile?(A.setUserData(e.data.profile),A.userLogin=!0,C.value=h("login.qrText4"),$message.success(h("login.qrText4")),$signIn&&$signIn(),clearInterval(Q.value),y.push("/music/user")):(A.userLogOut(),$message.error(h("login.qrText5")),z())})))}))}),1e3)},M=e=>{"qr"==e?z():clearInterval(Q.value)};return i((()=>{$setSiteTitle(h("login.login")),B.setPlayBarState(!1),z()})),r((()=>{B.setPlayBarState(!0),clearInterval(Q.value),clearInterval(H.value)})),(e,a)=>{const t=I,l=S,s=_,o=b,n=w,i=q;return u(),c("div",L,[g("div",O,[E,m(t,null,{default:p((()=>[d(v(e.$t("login.login",{name:f(N)})),1)])),_:1})]),m(i,{animated:"",class:"content",type:"segment","justify-content":"space-evenly","pane-style":{display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"30px"},"onUpdate:value":M},{default:p((()=>[m(o,{name:"qr",tab:e.$t("login.qr")},{default:p((()=>[m(s,{class:"qr-img"},{default:p((()=>[f(P)?(u(),x(f(k),{key:1,class:"qr",value:f(P),size:180,level:"H",background:"#00000000",foreground:f(D).themeData.primaryColor},null,8,["value","foreground"])):(u(),x(l,{key:0,style:{"min-width":"180px"},height:"180px",width:"180px"}))])),_:1}),g("span",U,v(f(C)),1)])),_:1},8,["tab"]),m(o,{name:"phone",tab:e.$t("login.phone")},{default:p((()=>[m(n,{style:{width:"100%","margin-top":"-20px","margin-bottom":"12px"},type:"warning"},{default:p((()=>[d(v(e.$t("login.canNotUse")),1)])),_:1})])),_:1},8,["tab"]),m(o,{name:"email",tab:e.$t("login.email")},{default:p((()=>[m(n,{style:{width:"100%","margin-top":"-20px","margin-bottom":"12px"},type:"warning"},{default:p((()=>[d(v(e.$t("login.canNotUse")),1)])),_:1})])),_:1},8,["tab"])])),_:1})])}}},[["__scopeId","data-v-d3ecce78"]]);export{A as default};
