import{_ as e,d8 as a,di as l,D as s,e as t,o as n,k as o,w as d,a as i,b as u,t as r,u as c,q as m,ch as p,e2 as g,an as v,g as f,cJ as h,cP as y,ac as k,c as b,F as _,x as w,d as $,j as C,e3 as D,e4 as x,d9 as z,d7 as M,ae as S,dX as L,bO as P,e5 as j,cX as T,cb as R,e6 as I,e7 as F,e8 as q,e9 as A,dZ as H,df as U,dg as E,ea as N,dd as J,am as X,eb as B,ds as G,z as V,db as O}from"./index-d93ecfd9.js";import{A as Q}from"./AllArtists-e33e1687.js";import{A as W}from"./AddPlaylist-0e9ef9cc.js";import{S as Y}from"./SmallSongData-d7110d79.js";import{a as Z,_ as K}from"./FormItem-ccd063f6.js";import{_ as ee}from"./InputNumber-43a45814.js";import{_ as ae}from"./Space-76cfe381.js";import{_ as le}from"./Alert-a6104c4f.js";import{_ as se}from"./text-f881741e.js";import{_ as te}from"./Radio-24bd6234.js";import{_ as ne}from"./RadioGroup-cb180d59.js";import{_ as oe}from"./Avatar-d697b90d.js";import{_ as de}from"./Tag-9bd41f20.js";import{_ as ie}from"./Dropdown-ca523edc.js";import{_ as ue,a as re}from"./DrawerContent-b50dea9b.js";import{_ as ce}from"./Spin-c12f3861.js";const me=e({__name:"CloudMatch",setup(e,{expose:y}){const{t:k}=a(),b=l(),_=s("cloudDataLoad",null),w=t(null),$=t(!1),C=t(null),D=t(null),x=t({uid:b.getUserData.userId,sid:null,asid:null}),z=()=>{C.value=null,D.value=null,x.value.asid=null,$.value=!1};return y({openCloudMatch:e=>{x.value.sid=e.id,C.value=e,$.value=!0}}),(e,a)=>{const l=v,s=Z,t=ee,y=f,b=K,M=ae,S=h;return n(),o(S,{class:"s-modal",show:c($),"onUpdate:show":a[3]||(a[3]=e=>p($)?$.value=e:null),preset:"card",title:e.$t("menu.match"),bordered:!1,"on-after-leave":z},{footer:d((()=>[i(M,{justify:"end"},{default:d((()=>[i(y,{onClick:z},{default:d((()=>[u(r(e.$t("general.dialog.cancel")),1)])),_:1}),i(y,{type:"primary",onClick:a[2]||(a[2]=e=>{var a;(a=c(x)).sid==a.asid?$message.error(k("other.noNeedMatch")):w.value?w.value.checkSongData()?g(a.uid,a.sid,a.asid).then((e=>{e.data?(z(),$message.success(k("other.matchSuccess")),_()):$message.error(k("other.matchFailed"))})):$message.error(k("other.matchError")):$message.error(k("other.plaseCheck"))}),disabled:!c(x).asid},{default:d((()=>[u(r(e.$t("general.dialog.match")),1)])),_:1},8,["disabled"])])),_:1})])),default:d((()=>[i(b,{class:"cloud-match","label-width":80,model:c(x)},{default:d((()=>[i(s,{label:e.$t("other.sData")},{default:d((()=>[i(l,{"content-style":"padding: 16px",bordered:!1,embedded:""},{default:d((()=>[i(Y,{songData:c(C),notJump:""},null,8,["songData"])])),_:1})])),_:1},8,["label"]),i(s,{label:e.$t("other.asId"),path:"asid"},{default:d((()=>[i(t,{value:c(x).asid,"onUpdate:value":a[0]||(a[0]=e=>c(x).asid=e),placeholder:e.$t("other.asIdDes"),"show-button":!1},null,8,["value","placeholder"]),i(y,{style:{"margin-left":"12px"},disabled:!c(x).asid,onClick:a[1]||(a[1]=e=>D.value=c(x).asid.toString())},{default:d((()=>[u(r(e.$t("general.dialog.check")),1)])),_:1},8,["disabled"])])),_:1},8,["label"])])),_:1},8,["model"]),c(D)?(n(),o(l,{key:0,"content-style":"padding: 16px",bordered:!1,embedded:""},{default:d((()=>[i(Y,{ref_key:"smallSongDataRef",ref:w,getDataByID:c(D),notJump:""},null,8,["getDataByID"])])),_:1})):m("",!0)])),_:1},8,["show","title"])}}},[["__scopeId","data-v-80e09f64"]]),pe={key:0},ge=e({__name:"DownloadSong",setup(e,{expose:s}){const{t:g}=a(),v=l(),z=y(),M=t(null),S=t(null),L=t(!1),P=t(!1),j=t(null),T=t(null),R=e=>{const a=e.privileges[0].downloadMaxbr;T.value=[{value:"128000",label:g("general.type.quality.l"),disabled:!(a>=128e3),size:I(e,"l")},{value:"192000",label:g("general.type.quality.m"),disabled:!(a>=192e3),size:I(e,"m")},{value:"320000",label:g("general.type.quality.h"),disabled:!(a>=32e4),size:I(e,"h")},{value:"420000",label:g("general.type.quality.sq"),disabled:[128e3,192e3,32e4].includes(parseInt(a)),size:I(e,"sq")},{value:"999000",label:"Hi-Res",disabled:!(a>=999e3),size:I(e,"hr")}],T.value},I=(e,a)=>{var l,s,t,n,o,d,i,u,r,c;let m=0;const p=e=>e?(e/1048576).toFixed(2):0;return"l"===a?m=p(null==(s=null==(l=e.songs[0])?void 0:l.l)?void 0:s.size):"m"===a?m=p(null==(n=null==(t=e.songs[0])?void 0:t.m)?void 0:n.size):"h"===a?m=p(null==(d=null==(o=e.songs[0])?void 0:o.h)?void 0:d.size):"sq"===a?m=p(null==(u=null==(i=e.songs[0])?void 0:i.sq)?void 0:u.size):"hr"===a&&(m=p(null==(c=null==(r=e.songs[0])?void 0:r.hr)?void 0:c.size)),m},F=()=>{M.value=null,S.value=null,L.value=!1,P.value=!1,j.value=null};return s({openDownloadModal:e=>{var a,l;v.userLogin?"user-cloud"===z.currentRoute.value.name||(null==(a=v.userData)?void 0:a.vipType)||0===(null==e?void 0:e.fee)||(null==e?void 0:e.pc)?(M.value=e.id,P.value=!0,l=e.id,x(l).then((e=>{var a;e.songs[0]&&e.privileges[0]?(S.value={album:e.songs[0].al,artist:e.songs[0].ar,name:e.songs[0].name,id:e.songs[0].id,pc:null==(a=e.songs[0])?void 0:a.pc},R(e)):$message.error(g("general.message.acquisitionFailed"))})).catch((e=>{F(),console.error(g("general.message.acquisitionFailed"),e),$message.error(g("general.message.acquisitionFailed"))}))):$message.error(g("general.message.needVip")):$message.error(g("general.message.needLogin"))}}),(e,a)=>{const l=le,s=se,t=te,v=ae,y=ne,x=f,z=h;return n(),o(z,{class:"s-modal downloadModal",show:c(P),"onUpdate:show":a[2]||(a[2]=e=>p(P)?P.value=e:null),preset:"card",title:e.$t("menu.download"),bordered:!1,"on-after-leave":F},{footer:d((()=>[i(v,{justify:"end"},{default:d((()=>[i(x,{onClick:F},{default:d((()=>[u(r(e.$t("general.dialog.cancel")),1)])),_:1}),i(x,{disabled:!c(j),loading:c(L),type:"primary",onClick:a[1]||(a[1]=e=>{return a=c(M),l=c(j),s=c(S).artist[0].name+"-"+c(S).name,L.value=!0,void D(a,l).then((e=>{if(e.data.url){const a=e.data.type.toLowerCase(),l=s||g("general.name.unknownSong");fetch(e.data.url.replace(/^http:/,"https:")).then((e=>e.blob())).then((e=>{const t=window.URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`${l}.${a}`,document.body.appendChild(n),n.click(),n.remove(),F(),L.value=!1,$message.success(g("general.message.downloadSuccess",{name:s}))}))}else L.value=!1,$message.error(g("general.message.downloadFailure"))})).catch((e=>{F(),console.error(g("general.message.downloadError"),e),$message.error(g("general.message.downloadError"))}));var a,l,s})},{default:d((()=>[u(r(c(L)?e.$t("general.dialog.downloadingNow"):e.$t("general.dialog.download")),1)])),_:1},8,["disabled","loading"])])),_:1})])),default:d((()=>[i(k,{mode:"out-in"},{default:d((()=>[c(S)?(n(),b("div",pe,[i(Y,{ref:"smallSongDataRef",songData:c(S),notJump:""},null,8,["songData"]),c(S).pc?(n(),o(l,{key:0,class:"tip",type:"info","show-icon":!1},{default:d((()=>[u(r(e.$t("other.cloudTip")),1)])),_:1})):m("",!0),i(y,{class:"downloadGroup",value:c(j),"onUpdate:value":a[0]||(a[0]=e=>p(j)?j.value=e:null),name:"downloadGroup"},{default:d((()=>[i(v,{vertical:""},{default:d((()=>[(n(!0),b(_,null,w(c(T),(a=>(n(),o(t,{key:a,value:a.value,disabled:a.disabled},{default:d((()=>[$("div",{class:C(a.disabled?"text disabled":"text")},[i(s,{class:"name"},{default:d((()=>[u(r(a.label),1)])),_:2},1024),a.size?(n(),o(s,{key:0,class:"size",depth:3},{default:d((()=>[u(r(a.size),1)])),_:2},1024)):a.disabled?m("",!0):(n(),o(s,{key:1,class:"error",depth:3},{default:d((()=>[u(r(e.$t("general.message.acquisitionFailed")),1)])),_:1}))],2)])),_:2},1032,["value","disabled"])))),128))])),_:1})])),_:1},8,["value"])])):(n(),o(s,{key:1},{default:d((()=>[u(r(e.$t("general.message.isLoading")),1)])),_:1}))])),_:1})])),_:1},8,["show","title"])}}},[["__scopeId","data-v-95b31f23"]]),ve={key:0,class:"datalists",id:"datalists"},fe={key:1,class:"num"},he={class:"name"},ye={class:"title"},ke={class:"meta"},be={key:2,class:"album"},_e={class:"action"},we={class:"menu"},$e={class:"item"},Ce=e({__name:"DataLists",props:{listData:{type:Array,default:[]},hideAlbum:{type:Boolean,default:!1}},setup(e){const{t:s}=a(),g=y(),f=z(),h=M(),D=l(),x=t(null),Z=t(null),K=t(null),ee=e,ae=t(0),le=t(0),te=t(!1),ne=t(null),pe=t(!1),Ce=t(null),De=(e,a=!0)=>()=>V(P,{depth:2,style:{transform:"translateX(2px)"}},{default:()=>V(e,{theme:a?"filled":"outline"})}),xe=()=>{te.value=!1},ze=(e,a=!0)=>{if(navigator.clipboard)try{navigator.clipboard.writeText(a?`https://music.163.com/#/song?id=${e}`:e),$message.success(s("general.message.copySuccess"))}catch(l){console.error(s("general.message.copyFailure"),l),$message.error(s("general.message.copyFailure"))}else $message.error(s("general.message.notSupported"))},Me=e=>{$dialog.warning({class:"s-dialog",title:s("general.dialog.delete"),content:s("menu.deleteQuestion",{name:e.name}),positiveText:s("general.dialog.delete"),negativeText:s("general.dialog.cancel"),onPositiveClick:()=>{B(e.id).then((a=>{200==a.code?($message.success(s("general.message.deleteSuccess")),ee.listData.forEach(((a,l)=>{a.id==e.id&&ee.listData.splice(l,1)}))):$message.error(s("general.message.deleteFailure"))}))}})},Se=(e,a)=>{f.getPersonalFmMode&&(G($player),f.setPersonalFmMode(!1)),f.setPlayState(!0),"history"!==g.currentRoute.value.name&&f.setPlaylists(e),"user-cloud"===g.currentRoute.value.name?f.setPlayListMode("cloud"):f.setPlayListMode("list"),f.addSongToPlaylists(a)},Le=(e,a)=>{switch(a){case 1:g.push(`/song?id=${e}`);break;case 10:g.push(`/album?id=${e}`)}};return(a,l)=>{const t=oe,y=se,z=de,M=v,B=ie,G=ue,V=re,Pe=ce;return n(),o(k,{mode:"out-in"},{default:d((()=>[e.listData[0]?(n(),b("div",ve,[(n(!0),b(_,null,w(e.listData,(l=>(n(),o(M,{key:l,class:C(c(f).getPlaySongData&&c(f).getPlaySongData.id==l.id?"songs play":"songs"),"content-style":{padding:"16px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},hoverable:"",onDblclick:a=>"dblclick"===c(h).listClickMode?Se(e.listData,l):null,onClick:a=>((e,a)=>{window.innerWidth>768?"click"===h.listClickMode&&Se(e,a):Se(e,a)})(e.listData,l),onContextmenu:e=>{return t=l,(a=e).preventDefault(),te.value=!1,void X().then((()=>{var e;ne.value=[{key:"play",label:s("menu.play"),icon:De(R),props:{onClick:()=>{Se(ee.listData,t)}}},{key:"nextPlay",label:s("menu.nextPlay"),icon:De(I),show:!f.getPersonalFmMode&&(null==(e=f.getPlaySongData)?void 0:e.id)!=t.id,props:{onClick:()=>{f.addSongToNext(t)}}},{key:"add",label:s("menu.add"),icon:De(F),show:!!D.userLogin,props:{onClick:()=>{x.value.openAddToPlaylist(t.id)}}},{key:"download",label:s("menu.download"),icon:De(j),props:{onClick:()=>{K.value.openDownloadModal(t)}}},{key:"comment",label:s("menu.comment"),icon:De(q,!1),props:{onClick:()=>{g.push(`/comment?id=${t.id}`)}}},{key:"mv",label:s("menu.mv"),icon:De(A,!1),show:!(!t.mv||0==t.mv),props:{onClick:()=>{g.push(`/video?id=${t.mv}`)}}},{key:"line1",type:"divider",show:"user-cloud"===g.currentRoute.value.name},{key:"delete",label:s("menu.delete"),icon:De(J),show:"user-cloud"===g.currentRoute.value.name,props:{onClick:()=>{Me(t)}}},{key:"match",label:s("menu.match"),icon:De(N),show:"user-cloud"===g.currentRoute.value.name,props:{onClick:()=>{Z.value.openCloudMatch(t)}}},{key:"line2",type:"divider"},{key:"search",label:s("menu.search"),icon:De(O,!1),props:{onClick:()=>{g.push({path:"/search/songs",query:{keywords:t.name,page:1}})}}},{key:"copyId",label:s("menu.copy",{name:s("general.name.song"),other:"ID"}),icon:De(N,!1),props:{onClick:()=>{ze(t.id,!1)}}},{key:"copy",label:s("menu.copy",{name:s("general.name.song"),other:s("general.name.link")}),icon:De(H),props:{onClick:()=>{ze(t.id)}}}],te.value=!0,ae.value=a.clientX,le.value=a.clientY}));var a,t}},{default:d((()=>{var s;return[(null==(s=l.album)?void 0:s.picUrl)?(n(),o(t,{key:0,lazy:"",class:"pic",src:l.album.picUrl.replace(/^http:/,"https:")+"?param=60y60","fallback-src":"/img/music/pic/default.png"},null,8,["src"])):l.num?(n(),b("div",fe,[i(y,{depth:2,innerHTML:l.num},null,8,["innerHTML"])])):m("",!0),$("div",he,[$("div",ye,[i(y,{class:"text-hidden",depth:"2",innerHTML:l.name,onClick:S((e=>Le(l.id,1)),["stop"])},null,8,["innerHTML","onClick"]),1==l.fee||4==l.fee?(n(),o(z,{key:0,class:"vip",round:"",bordered:!1,size:"small"},{default:d((()=>[u(r(1==l.fee?"VIP":"EP"),1)])),_:2},1024)):m("",!0),l.pc?(n(),o(z,{key:1,class:"cloud",round:"",type:"info",size:"small",bordered:!1},{default:d((()=>[u(r(a.$t("general.name.cloud")),1)])),_:1})):m("",!0),l.mv?(n(),o(z,{key:2,class:"mv",round:"",type:"warning",size:"small",bordered:!1,onClick:S((e=>c(g).push(`/video?id=${l.mv}`)),["stop"])},{default:d((()=>[u(" MV ")])),_:2},1032,["onClick"])):m("",!0)]),$("div",ke,[l.artist?(n(),o(Q,{key:0,class:"text-hidden",artistsData:l.artist},null,8,["artistsData"])):m("",!0),l.alia&&l.alia[0]?(n(),o(y,{key:1,class:"alia text-hidden",depth:"3",innerHTML:l.alia[0]},null,8,["innerHTML"])):m("",!0)])]),!e.hideAlbum&&l.album?(n(),b("div",be,[i(y,{innerHTML:l.album.name,onClick:S((e=>Le(l.album.id,10)),["stop"])},null,8,["innerHTML","onClick"])])):m("",!0),$("div",_e,[i(c(P),{class:"like",size:"20",onClick:S((e=>c(f).getSongIsLike(l.id)?c(f).changeLikeList(l.id,!1):c(f).changeLikeList(l.id,!0)),["stop"])},{default:d((()=>[i(c(L),{theme:c(f).getSongIsLike(l.id)?"filled":"outline"},null,8,["theme"])])),_:2},1032,["onClick"]),i(c(P),{class:"download",size:"20",onClick:S((e=>c(K).openDownloadModal(l)),["stop"])},{default:d((()=>[i(c(j),{theme:"filled"})])),_:2},1032,["onClick"]),i(c(P),{class:"more",size:"20",component:c(T),onClick:S((e=>{return a=l,Ce.value=a,void(pe.value=!0);var a}),["stop"])},null,8,["component","onClick"])]),i(y,{class:"time",innerHTML:l.time},null,8,["innerHTML"])]})),_:2},1032,["class","onDblclick","onClick","onContextmenu"])))),128)),i(B,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:c(ae),y:c(le),options:c(ne),show:c(te),"on-clickoutside":xe,onSelect:l[0]||(l[0]=e=>te.value=!1)},null,8,["x","y","options","show"]),i(V,{class:"drawer",show:c(pe),"onUpdate:show":l[11]||(l[11]=e=>p(pe)?pe.value=e:null),placement:"bottom",height:"70vh",style:{"border-radius":"8px 8px 0 0"}},{default:d((()=>[c(Ce)?(n(),o(G,{key:0,"native-scrollbar":!1,"body-content-style":"padding: 0",closable:""},{header:d((()=>[i(Y,{songData:c(Ce),notJump:""},null,8,["songData"])])),default:d((()=>[$("div",we,[$("div",{class:"item",onClick:l[1]||(l[1]=()=>{Se(e.listData,c(Ce)),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(R),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.play")),1)])),_:1})]),c(f).getPersonalFmMode||c(f).getPlaySongData.id==c(Ce).id?m("",!0):(n(),b("div",{key:0,class:"item",onClick:l[2]||(l[2]=()=>{c(f).addSongToNext(c(Ce)),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(I),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.nextPlay")),1)])),_:1})])),$("div",{class:"item",onClick:l[3]||(l[3]=()=>{c(x).openAddToPlaylist(c(Ce).id),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(F),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.add")),1)])),_:1})]),$("div",{class:"item",onClick:l[4]||(l[4]=()=>{c(K).openDownloadModal(c(Ce)),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(j),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.download")),1)])),_:1})]),$("div",{class:"item",onClick:l[5]||(l[5]=e=>c(g).push(`/comment?id=${c(Ce).id}`))},[i(c(P),{size:"20"},{default:d((()=>[i(c(q),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.comment")),1)])),_:1})]),c(Ce).mv?(n(),b("div",{key:1,class:"item",onClick:l[6]||(l[6]=e=>c(g).push(`/video?id=${c(Ce).mv}`))},[i(c(P),{size:"20"},{default:d((()=>[i(c(A),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.mv")),1)])),_:1})])):m("",!0),$("div",{class:"item",onClick:l[7]||(l[7]=()=>{ze(c(Ce).id),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(H),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.copy")),1)])),_:1})]),$("div",$e,[i(c(P),{size:"20"},{default:d((()=>[i(c(U),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("general.name.artists"))+": ",1),i(Q,{class:"text-hidden",artistsData:c(Ce).artist},null,8,["artistsData"])])),_:1})]),$("div",{class:"item",onClick:l[8]||(l[8]=e=>c(g).push(`/album?id=${c(Ce).album.id}`))},[i(c(P),{size:"20"},{default:d((()=>[i(c(E),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("general.name.album"))+": "+r(c(Ce).album.name),1)])),_:1})]),"user-cloud"===c(g).currentRoute.value.name?(n(),b("div",{key:2,class:"item",onClick:l[9]||(l[9]=()=>{c(Z).openCloudMatch(c(Ce)),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(N),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.match")),1)])),_:1})])):m("",!0),"user-cloud"===c(g).currentRoute.value.name?(n(),b("div",{key:3,class:"item",onClick:l[10]||(l[10]=()=>{Me(c(Ce)),pe.value=!1})},[i(c(P),{size:"20"},{default:d((()=>[i(c(J),{theme:"filled"})])),_:1}),i(y,null,{default:d((()=>[u(r(a.$t("menu.delete")),1)])),_:1})])):m("",!0)])])),_:1})):m("",!0)])),_:1},8,["show"]),i(me,{ref_key:"cloudMatchRef",ref:Z},null,512),i(W,{ref_key:"addPlayListRef",ref:x},null,512),i(ge,{ref_key:"downloadSongRef",ref:K},null,512)])):(n(),o(Pe,{key:1,class:"loading",size:"small"}))])),_:1})}}},[["__scopeId","data-v-d677b7a9"]]);export{Ce as D};
