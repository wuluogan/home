import{c2 as e,a as l,cN as s,cO as a,cQ as t,e as o,o as i,k as r,w as n,b as u,t as c,u as d,c8 as p,dg as m,g,cv as y,_ as k,cB as h,cM as v,f,c as b,F as w,x as C,d as L,bO as _,q as $,ac as j,am as U,z as x,dh as T,di as R}from"./index-c72c5b0c.js";import{l as z}from"./album-8a3f3da2.js";import{A as H}from"./AllArtists-b2fee903.js";import{_ as P}from"./Input-b4caa030.js";import{a as V,_ as A}from"./FormItem-e0127deb.js";import{_ as D}from"./Select-714380b7.js";import{_ as M}from"./Space-5d75b1a8.js";import{g as N}from"./getCoverUrl-bb08aa65.js";import{P as S}from"./PlayOne-22adba7e.js";import{L as W,a as q,_ as B}from"./LinkTwo-8d6bc0a2.js";import{U as F}from"./Unlike-d603c2d2.js";import{_ as I}from"./Image-6ba3d672.js";import{_ as Z,a as E}from"./Grid-1728937a.js";import{D as O}from"./DeleteFour-7678c621.js";import{_ as Q}from"./Skeleton-163a49d9.js";import{_ as X}from"./Dropdown-db0b14d8.js";const G=e("editor",!0,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M40 33V42C40 43.1046 39.1046 44 38 44H31.5",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M40 16V6C40 4.89543 39.1046 4 38 4H10C8.89543 4 8 4.89543 8 6V42C8 43.1046 8.89543 44 10 44H16",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M16 16H30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M23 44L40 23",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null),l("path",{d:"M16 24H24",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap},null)])})),Y=e("headset",!1,(function(e){return l("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[l("path",{d:"M42 30V24.4615C42 14.2655 33.9411 6 24 6C14.0589 6 6 14.2655 6 24.4615V30",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M34 32C34 29.7909 35.7909 28 38 28H42V42H38C35.7909 42 34 40.2091 34 38V32Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),l("path",{d:"M42 32H44C45.1046 32 46 32.8954 46 34V36C46 37.1046 45.1046 38 44 38H42V32Z",fill:e.colors[0]},null),l("path",{d:"M6 32H4C2.89543 32 2 32.8954 2 34V36C2 37.1046 2.89543 38 4 38H6V32Z",fill:e.colors[0]},null),l("path",{d:"M6 28H10C12.2091 28 14 29.7909 14 32V38C14 40.2091 12.2091 42 10 42H6V28Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])})),J={__name:"PlaylistUpdate",setup(e,{expose:k}){const{t:h}=s(),{textRule:v}={textRule:{required:!0,message:"请填写必要信息",trigger:"blur"},numberRule:{type:"number",required:!0,message:"请填写必要信息",trigger:"blur"},emailRule:{required:!0,validator:(e,l)=>l?!!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l)||new Error("请输入正确的电子邮箱"):new Error("请输入电子邮箱"),trigger:["input","blur"]},mobileRule:{key:"phone",required:!0,validator:(e,l)=>l?!!/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1589]))\d{8}$/.test(l)||new Error("请输入正确的手机号码"):new Error("请输入手机号码"),trigger:["input","blur"]}},f=a(),b=t(),w=o(null),C=o(null),L=o(!1),_={name:v},$=o({name:null,desc:null,tags:null}),j=e=>{var l;e.preventDefault(),null==(l=C.value)||l.validate((e=>{e?($loadingBar.error(),$message.error(h("general.message.needCheck"))):m(w.value,$._value.name,$._value.desc,$._value.tags.join(";")).then((e=>{200===e.code?($message.success(h("general.message.editorSuccess")),T(),b.setUserPlayLists()):$message.error(h("general.message.editorFailed"))}))}))},U=o([]),x=()=>{f.catList.sub?U.value=f.catList.sub.map((e=>({label:e.name,value:e.name}))):f.setCatList()},T=()=>{L.value=!1,w.value=null};return k({openUpdateModal:e=>{$.value={name:e.name,desc:e.desc,tags:e.tags},w.value=e.id,L.value=!0}}),(e,s)=>{const a=P,t=V,o=D,m=A,k=g,h=M,v=y;return i(),r(v,{class:"s-modal",show:d(L),"onUpdate:show":s[3]||(s[3]=e=>p(L)?L.value=e:null),preset:"card",title:e.$t("menu.update"),bordered:!1,"on-after-leave":T},{footer:n((()=>[l(h,{justify:"end"},{default:n((()=>[l(k,{onClick:T},{default:n((()=>[u(c(e.$t("general.dialog.cancel")),1)])),_:1}),l(k,{type:"primary",onClick:j},{default:n((()=>[u(c(e.$t("general.dialog.editor")),1)])),_:1})])),_:1})])),default:n((()=>[l(m,{ref_key:"playlistUpdateRef",ref:C,rules:_,"label-width":80,model:d($)},{default:n((()=>[l(t,{label:e.$t("other.plName"),path:"name"},{default:n((()=>[l(a,{value:d($).name,"onUpdate:value":s[0]||(s[0]=e=>d($).name=e),placeholder:e.$t("other.plNameTip")},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plDes"),path:"desc"},{default:n((()=>[l(a,{value:d($).desc,"onUpdate:value":s[1]||(s[1]=e=>d($).desc=e),type:"textarea",placeholder:e.$t("other.plDesTip"),autosize:{minRows:3,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["label"]),l(t,{label:e.$t("other.plTag"),path:"tags"},{default:n((()=>[l(o,{multiple:"",value:d($).tags,"onUpdate:value":s[2]||(s[2]=e=>d($).tags=e),placeholder:e.$t("other.plTagTip"),options:d(U),onClick:x},null,8,["value","placeholder","options"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["show","title"])}}},K={class:"coverlists"},ee={class:"cover"},le={class:"cover-loading"},se={key:0,class:"description"},ae={key:0,class:"num"},te={class:"des"},oe={key:1,class:"num"},ie={class:"des"},re={class:"title"},ne={class:"name text-hidden"},ue={key:0,class:"by"},ce={key:1,class:"by"},de=k({__name:"CoverLists",props:{listData:{type:Array,default:[]},listType:{type:String,default:"playlist"},columns:{type:String,default:"3 s:4 m:5 l:6"},gridCollapsed:{type:Boolean,default:!1},gridCollapsedRows:{type:Number,default:2},loadingNum:{type:Number,default:30}},setup(e){const{t:u}=s(),p=h(),m=a(),g=t(),y=v(),k=e,P=o(null),V=e=>()=>x(_,{style:{transform:"translateX(2px)"}},{default:()=>e}),A=o(0),D=o(0),M=o(!1),de=o(null),pe=()=>{M.value=!1},me=e=>{var l;if(e.id===(null==(l=g.getUserPlayLists)?void 0:l.own[0].id))return $message.warning(u("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:u("general.dialog.delete"),content:u("menu.delQuestion",{name:e.name}),positiveText:u("general.dialog.delete"),negativeText:u("general.dialog.cancel"),onPositiveClick:()=>{T(e.id).then((e=>{200===e.code&&($message.success(u("general.message.deleteSuccess")),g.setUserPlayLists())}))}})},ge=e=>{const l=k.listType,s=g.getUserPlayLists.like,a=g.getUserAlbumLists.list;return"playlist"===l&&s.length?!s.some((l=>l.id===Number(e))):"album"!==l||!a.length||!a.some((l=>l.id===Number(e)))},ye=async e=>{const l=k.listType,s=ge(e)?1:2,a="playlist"===l?R:z,t=u("playlist"===l?"general.name.playlist":"general.name.album"),o="zh-CN"===y.language?"":" ";try{200===(await a(s,e)).code?($message.success(`${t+o}${u(1==s?"menu.collection":"menu.cancelCollection",{name:u("general.dialog.success")})}`),"playlist"===l?g.setUserPlayLists():g.setUserAlbumLists()):$message.error(`${t+o}${u(1==s?"menu.collection":"menu.cancelCollection",{name:u("general.dialog.failed")})}`)}catch(i){$message.error(`${t+o}${u(1==s?"menu.collection":"menu.cancelCollection",{name:u("general.dialog.failed")})}`),console.error(`${t+o}${u(1==s?"menu.collection":"menu.cancelCollection",{name:u("general.dialog.failed")})}`,i)}};return f((()=>{"user-playlists"!==p.currentRoute.value.name||m.catList.sub||m.setCatList(),!g.userLogin||g.getUserPlayLists.has||g.getUserPlayLists.isLoading||"playlist"!==k.listType||g.setUserPlayLists(),!g.userLogin||g.getUserAlbumLists.has||g.getUserAlbumLists.isLoading||"album"!==k.listType||g.setUserAlbumLists()})),(s,a)=>{const t=B,o=I,m=Z,y=E,h=Q,v=X;return i(),b("div",K,[l(j,{mode:"out-in"},{default:n((()=>[e.listData[0]?(i(),r(y,{key:0,"x-gap":"20","y-gap":"26",responsive:"screen",cols:e.columns,collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:n((()=>[(i(!0),b(w,null,C(e.listData,(s=>(i(),r(m,{class:"item",key:s,onClick:e=>{return l=s.id,void("playlist"===k.listType||"topList"===k.listType?p.push({path:"/music/playlist",query:{id:l,page:1}}):"album"===k.listType&&p.push({path:"/music/album",query:{id:l}}));var l},onContextmenu:e=>{return a=s,(l=e).preventDefault(),M.value=!1,void U().then((()=>{de.value=[{key:"update",label:u("menu.update"),show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{P.value.openUpdateModal(a)}},icon:V(x(G))},{key:"del",label:u("menu.del"),show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{me(a)}},icon:V(x(O))},{key:"likePlaylist",label:ge(a.id)?u("menu.collection",{name:u("general.name.playlist")}):u("menu.cancelCollection",{name:u("general.name.playlist")}),show:!(!g.userLogin||!g.getUserPlayLists.has||"playlist"!==k.listType||"user-playlists"===p.currentRoute.value.name),props:{onClick:()=>{ye(a.id)}},icon:V(x(ge(a.id)?W:F))},{key:"likeAlbum",label:ge(a.id)?u("menu.collection",{name:u("general.name.album")}):u("menu.cancelCollection",{name:u("general.name.album")}),show:!(!g.userLogin||!g.getUserAlbumLists.has||"album"!==k.listType),props:{onClick:()=>{ye(a.id)}},icon:V(x(ge(a.id)?W:F))},{key:"copy",label:u("menu.copy",{name:"playlist"===k.listType?u("general.name.playlist"):u("general.name.album"),other:u("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/${"playlist"===k.listType?"playlist":"album"}?id=${a.id}`),$message.success(u("general.message.copySuccess"))}catch(e){console.error(u("general.message.copyFailure"),e),$message.error(u("general.message.copyFailure"))}else $message.error(u("general.message.notSupported"))}},icon:V(x(q))}],M.value=!0,A.value=l.clientX,D.value=l.clientY}));var l,a}},{default:n((()=>[L("div",ee,[l(o,{lazy:"",class:"coverImg","preview-disabled":"",src:d(N)(s.cover,300),"fallback-src":"/img/music/pic/default.png"},{placeholder:n((()=>[L("div",le,[l(t,{size:"small"})])])),_:2},1032,["src"]),l(o,{lazy:"",class:"shadow","preview-disabled":"",src:d(N)(s.cover,300),"fallback-src":"/img/music/pic/default.png"},null,8,["src"]),l(d(_),{class:"play",size:"40"},{default:n((()=>[l(d(S),{theme:"filled"})])),_:1}),"topList"!=e.listType?(i(),b("div",se,["playlist"==e.listType?(i(),b("div",ae,[l(d(_),null,{default:n((()=>[l(d(Y),{theme:"filled"})])),_:1}),L("span",te,c(s.playCount),1)])):(i(),b("div",oe,[L("span",ie,c(s.time),1)]))])):$("",!0)]),L("div",re,[L("span",ne,c(s.name),1),"playlist"==e.listType&&s.artist?(i(),b("span",ue," By "+c(s.artist.nickname),1)):"topList"==e.listType&&s.update?(i(),b("span",ce,c(s.update),1)):(i(),r(H,{key:2,class:"text-hidden",artistsData:s.artist},null,8,["artistsData"]))])])),_:2},1032,["onClick","onContextmenu"])))),128))])),_:1},8,["cols","collapsed","collapsed-rows"])):(i(),r(y,{key:1,class:"loading","x-gap":"20","y-gap":"26",cols:e.columns,responsive:"screen",collapsed:e.gridCollapsed,"collapsed-rows":e.gridCollapsedRows},{default:n((()=>[(i(!0),b(w,null,C(e.loadingNum,(e=>(i(),r(m,{class:"item",key:e},{default:n((()=>[l(h,{class:"pic",sharp:!1}),l(h,{text:"",repeat:1}),l(h,{text:"",style:{width:"60%"}})])),_:2},1024)))),128))])),_:1},8,["cols","collapsed","collapsed-rows"]))])),_:1}),l(v,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:d(A),y:d(D),options:d(de),show:d(M),"on-clickoutside":pe,onSelect:a[0]||(a[0]=e=>M.value=!1)},null,8,["x","y","options","show"]),l(J,{ref_key:"playlistUpdateRef",ref:P},null,512)])}}},[["__scopeId","data-v-fd13958e"]]);export{de as C};
