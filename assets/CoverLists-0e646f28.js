import{d8 as e,d9 as l,di as a,e as s,o as t,k as r,w as i,a as o,b as n,t as u,u as d,ch as c,dU as p,g as m,cJ as g,_ as y,cP as v,d7 as f,f as b,c as h,F as k,x as _,d as $,bO as w,cb as C,dV as L,q as U,ac as T,am as x,z as R,dW as j,dd as A,dX as P,dY as D,dZ as S,d_ as z,d$ as N}from"./index-d93ecfd9.js";import{l as q}from"./album-72ad8940.js";import{A as F}from"./AllArtists-e33e1687.js";import{_ as I}from"./Input-19ebdc3b.js";import{a as E,_ as X}from"./FormItem-ccd063f6.js";import{_ as Z}from"./Select-d00ca0af.js";import{_ as B}from"./Space-76cfe381.js";import{g as J}from"./getCoverUrl-bb08aa65.js";import{_ as M}from"./Spin-c12f3861.js";import{_ as Y}from"./Image-46cbaef1.js";import{_ as G,a as O}from"./Grid-86a1f343.js";import{_ as Q}from"./Skeleton-8803bfe7.js";import{_ as V}from"./Dropdown-ca523edc.js";const W={__name:"PlaylistUpdate",setup(y,{expose:v}){const{t:f}=e(),{textRule:b}={textRule:{required:!0,message:"请填写必要信息",trigger:"blur"},numberRule:{type:"number",required:!0,message:"请填写必要信息",trigger:"blur"},emailRule:{required:!0,validator:(e,l)=>l?!!/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(l)||new Error("请输入正确的电子邮箱"):new Error("请输入电子邮箱"),trigger:["input","blur"]},mobileRule:{key:"phone",required:!0,validator:(e,l)=>l?!!/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1589]))\d{8}$/.test(l)||new Error("请输入正确的手机号码"):new Error("请输入手机号码"),trigger:["input","blur"]}},h=l(),k=a(),_=s(null),$=s(null),w=s(!1),C={name:b},L=s({name:null,desc:null,tags:null}),U=e=>{var l;e.preventDefault(),null==(l=$.value)||l.validate((e=>{e?($loadingBar.error(),$message.error(f("general.message.needCheck"))):p(_.value,L._value.name,L._value.desc,L._value.tags.join(";")).then((e=>{200===e.code?($message.success(f("general.message.editorSuccess")),R(),k.setUserPlayLists()):$message.error(f("general.message.editorFailed"))}))}))},T=s([]),x=()=>{h.catList.sub?T.value=h.catList.sub.map((e=>({label:e.name,value:e.name}))):h.setCatList()},R=()=>{w.value=!1,_.value=null};return v({openUpdateModal:e=>{L.value={name:e.name,desc:e.desc,tags:e.tags},_.value=e.id,w.value=!0}}),(e,l)=>{const a=I,s=E,p=Z,y=X,v=m,f=B,b=g;return t(),r(b,{class:"s-modal",show:d(w),"onUpdate:show":l[3]||(l[3]=e=>c(w)?w.value=e:null),preset:"card",title:e.$t("menu.update"),bordered:!1,"on-after-leave":R},{footer:i((()=>[o(f,{justify:"end"},{default:i((()=>[o(v,{onClick:R},{default:i((()=>[n(u(e.$t("general.dialog.cancel")),1)])),_:1}),o(v,{type:"primary",onClick:U},{default:i((()=>[n(u(e.$t("general.dialog.editor")),1)])),_:1})])),_:1})])),default:i((()=>[o(y,{ref_key:"playlistUpdateRef",ref:$,rules:C,"label-width":80,model:d(L)},{default:i((()=>[o(s,{label:e.$t("other.plName"),path:"name"},{default:i((()=>[o(a,{value:d(L).name,"onUpdate:value":l[0]||(l[0]=e=>d(L).name=e),placeholder:e.$t("other.plNameTip")},null,8,["value","placeholder"])])),_:1},8,["label"]),o(s,{label:e.$t("other.plDes"),path:"desc"},{default:i((()=>[o(a,{value:d(L).desc,"onUpdate:value":l[1]||(l[1]=e=>d(L).desc=e),type:"textarea",placeholder:e.$t("other.plDesTip"),autosize:{minRows:3,maxRows:5}},null,8,["value","placeholder"])])),_:1},8,["label"]),o(s,{label:e.$t("other.plTag"),path:"tags"},{default:i((()=>[o(p,{multiple:"",value:d(L).tags,"onUpdate:value":l[2]||(l[2]=e=>d(L).tags=e),placeholder:e.$t("other.plTagTip"),options:d(T),onClick:x},null,8,["value","placeholder","options"])])),_:1},8,["label"])])),_:1},8,["model"])])),_:1},8,["show","title"])}}},H={class:"coverlists"},K={class:"cover"},ee={class:"cover-loading"},le={key:0,class:"description"},ae={key:0,class:"num"},se={class:"des"},te={key:1,class:"num"},re={class:"des"},ie={class:"title"},oe={class:"name text-hidden"},ne={key:0,class:"by"},ue={key:1,class:"by"},de=y({__name:"CoverLists",props:{listData:{type:Array,default:[]},listType:{type:String,default:"playlist"},columns:{type:String,default:"3 s:4 m:5 l:6"},gridCollapsed:{type:Boolean,default:!1},gridCollapsedRows:{type:Number,default:2},loadingNum:{type:Number,default:30}},setup(n){const{t:c}=e(),p=v(),m=l(),g=a(),y=f(),I=n,E=s(null),X=e=>()=>R(w,{style:{transform:"translateX(2px)"}},{default:()=>e}),Z=s(0),B=s(0),de=s(!1),ce=s(null),pe=()=>{de.value=!1},me=e=>{var l;if(e.id===(null==(l=g.getUserPlayLists)?void 0:l.own[0].id))return $message.warning(c("menu.unableToDelete")),!1;$dialog.warning({class:"s-dialog",title:c("general.dialog.delete"),content:c("menu.delQuestion",{name:e.name}),positiveText:c("general.dialog.delete"),negativeText:c("general.dialog.cancel"),onPositiveClick:()=>{z(e.id).then((e=>{200===e.code&&($message.success(c("general.message.deleteSuccess")),g.setUserPlayLists())}))}})},ge=e=>{const l=I.listType,a=g.getUserPlayLists.like,s=g.getUserAlbumLists.list;return"playlist"===l&&a.length?!a.some((l=>l.id===Number(e))):"album"!==l||!s.length||!s.some((l=>l.id===Number(e)))},ye=async e=>{const l=I.listType,a=ge(e)?1:2,s="playlist"===l?N:q,t=c("playlist"===l?"general.name.playlist":"general.name.album"),r="zh-CN"===y.language?"":" ";try{200===(await s(a,e)).code?($message.success(`${t+r}${c(1==a?"menu.collection":"menu.cancelCollection",{name:c("general.dialog.success")})}`),"playlist"===l?g.setUserPlayLists():g.setUserAlbumLists()):$message.error(`${t+r}${c(1==a?"menu.collection":"menu.cancelCollection",{name:c("general.dialog.failed")})}`)}catch(i){$message.error(`${t+r}${c(1==a?"menu.collection":"menu.cancelCollection",{name:c("general.dialog.failed")})}`),console.error(`${t+r}${c(1==a?"menu.collection":"menu.cancelCollection",{name:c("general.dialog.failed")})}`,i)}};return b((()=>{"user-playlists"!==p.currentRoute.value.name||m.catList.sub||m.setCatList(),!g.userLogin||g.getUserPlayLists.has||g.getUserPlayLists.isLoading||"playlist"!==I.listType||g.setUserPlayLists(),!g.userLogin||g.getUserAlbumLists.has||g.getUserAlbumLists.isLoading||"album"!==I.listType||g.setUserAlbumLists()})),(e,l)=>{const a=M,s=Y,m=G,y=O,v=Q,f=V;return t(),h("div",H,[o(T,{mode:"out-in"},{default:i((()=>[n.listData[0]?(t(),r(y,{key:0,"x-gap":"20","y-gap":"26",responsive:"screen",cols:n.columns,collapsed:n.gridCollapsed,"collapsed-rows":n.gridCollapsedRows},{default:i((()=>[(t(!0),h(k,null,_(n.listData,(e=>(t(),r(m,{class:"item",key:e,onClick:l=>{return a=e.id,void("playlist"===I.listType||"topList"===I.listType?p.push({path:"/playlist",query:{id:a,page:1}}):"album"===I.listType&&p.push({path:"/album",query:{id:a}}));var a},onContextmenu:l=>{return s=e,(a=l).preventDefault(),de.value=!1,void x().then((()=>{ce.value=[{key:"update",label:c("menu.update"),show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{E.value.openUpdateModal(s)}},icon:X(R(j))},{key:"del",label:c("menu.del"),show:"user-playlists"===p.currentRoute.value.name,props:{onClick:()=>{me(s)}},icon:X(R(A))},{key:"likePlaylist",label:ge(s.id)?c("menu.collection",{name:c("general.name.playlist")}):c("menu.cancelCollection",{name:c("general.name.playlist")}),show:!(!g.userLogin||!g.getUserPlayLists.has||"playlist"!==I.listType||"user-playlists"===p.currentRoute.value.name),props:{onClick:()=>{ye(s.id)}},icon:X(R(ge(s.id)?P:D))},{key:"likeAlbum",label:ge(s.id)?c("menu.collection",{name:c("general.name.album")}):c("menu.cancelCollection",{name:c("general.name.album")}),show:!(!g.userLogin||!g.getUserAlbumLists.has||"album"!==I.listType),props:{onClick:()=>{ye(s.id)}},icon:X(R(ge(s.id)?P:D))},{key:"copy",label:c("menu.copy",{name:"playlist"===I.listType?c("general.name.playlist"):c("general.name.album"),other:c("general.name.link")}),props:{onClick:()=>{if(navigator.clipboard)try{navigator.clipboard.writeText(`https://music.163.com/#/${"playlist"===I.listType?"playlist":"album"}?id=${s.id}`),$message.success(c("general.message.copySuccess"))}catch(e){console.error(c("general.message.copyFailure"),e),$message.error(c("general.message.copyFailure"))}else $message.error(c("general.message.notSupported"))}},icon:X(R(S))}],de.value=!0,Z.value=a.clientX,B.value=a.clientY}));var a,s}},{default:i((()=>[$("div",K,[o(s,{lazy:"",class:"coverImg","preview-disabled":"",src:d(J)(e.cover,300),"fallback-src":"/img/music/pic/default.png"},{placeholder:i((()=>[$("div",ee,[o(a,{size:"small"})])])),_:2},1032,["src"]),o(s,{lazy:"",class:"shadow","preview-disabled":"",src:d(J)(e.cover,300),"fallback-src":"/img/music/pic/default.png"},null,8,["src"]),o(d(w),{class:"play",size:"40"},{default:i((()=>[o(d(C),{theme:"filled"})])),_:1}),"topList"!=n.listType?(t(),h("div",le,["playlist"==n.listType?(t(),h("div",ae,[o(d(w),null,{default:i((()=>[o(d(L),{theme:"filled"})])),_:1}),$("span",se,u(e.playCount),1)])):(t(),h("div",te,[$("span",re,u(e.time),1)]))])):U("",!0)]),$("div",ie,[$("span",oe,u(e.name),1),"playlist"==n.listType&&e.artist?(t(),h("span",ne," By "+u(e.artist.nickname),1)):"topList"==n.listType&&e.update?(t(),h("span",ue,u(e.update),1)):(t(),r(F,{key:2,class:"text-hidden",artistsData:e.artist},null,8,["artistsData"]))])])),_:2},1032,["onClick","onContextmenu"])))),128))])),_:1},8,["cols","collapsed","collapsed-rows"])):(t(),r(y,{key:1,class:"loading","x-gap":"20","y-gap":"26",cols:n.columns,responsive:"screen",collapsed:n.gridCollapsed,"collapsed-rows":n.gridCollapsedRows},{default:i((()=>[(t(!0),h(k,null,_(n.loadingNum,(e=>(t(),r(m,{class:"item",key:e},{default:i((()=>[o(v,{class:"pic",sharp:!1}),o(v,{text:"",repeat:1}),o(v,{text:"",style:{width:"60%"}})])),_:2},1024)))),128))])),_:1},8,["cols","collapsed","collapsed-rows"]))])),_:1}),o(f,{style:{"--n-font-size":"14px","--n-border-radius":"6px"},placement:"bottom-start",trigger:"manual",size:"large",x:d(Z),y:d(B),options:d(ce),show:d(de),"on-clickoutside":pe,onSelect:l[0]||(l[0]=e=>de.value=!1)},null,8,["x","y","options","show"]),o(W,{ref_key:"playlistUpdateRef",ref:E},null,512)])}}},[["__scopeId","data-v-42f4dd8d"]]);export{de as C};
